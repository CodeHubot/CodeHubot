# ==========================================
# CodeHubot AIoT智能体平台 - 外部数据库模式配置
# 使用前请复制此文件为 .env 并修改配置
# ==========================================
# 
# 📌 说明：此配置用于使用外部MySQL数据库的部署场景
# Docker容器只运行应用服务，不包含MySQL容器
# 适用场景：生产环境使用云数据库、已有MySQL服务等
#

# ==================== 外部数据库配置（必需）====================
# 外部MySQL数据库连接信息
# ⚠️ 确保外部MySQL服务正在运行且网络可达
EXTERNAL_DB_HOST=192.168.1.100
EXTERNAL_DB_PORT=3306
EXTERNAL_DB_USER=aiot_user
EXTERNAL_DB_PASSWORD=aiot_password
EXTERNAL_DB_NAME=aiot_admin

# ==================== Redis配置 ====================
REDIS_PORT=6379
REDIS_PASSWORD=

# ==================== MQTT Broker配置 ====================
# 内部服务连接MQTT（通常不需要修改）
MQTT_BROKER_HOST=mqtt
MQTT_BROKER_PORT=1883
MQTT_WS_PORT=9001
MQTT_USERNAME=
MQTT_PASSWORD=

# 设备连接MQTT（必须修改为外部可访问地址）
# ⚠️ 重要：这是告诉物联网设备应该连接到哪个MQTT服务器
# 必须填写设备可以访问的外部地址（域名或公网IP）
# 示例：mqtt.example.com 或 192.168.1.100
DEVICE_MQTT_BROKER=mqtt.example.com
DEVICE_MQTT_PORT=1883
DEVICE_MQTT_USE_SSL=false

# ==================== 服务端口配置 ====================
BACKEND_PORT=8000
CONFIG_SERVICE_PORT=8001
FRONTEND_PORT=8080
FLOWER_PORT=5555
PLUGIN_SERVICE_PORT=9000

# ==================== 服务器配置 ====================
SERVER_BASE_URL=http://localhost:8000
BACKEND_URL=http://backend:8000

# ==================== JWT配置（必需）====================
# 🔐 生成强密钥：python -c "import secrets; print(secrets.token_urlsafe(32))"
# ⚠️ 生产环境必须修改此密钥！不要使用示例密钥！
SECRET_KEY=PLEASE-CHANGE-ME-generate-your-own-secret-key-here
ALGORITHM=HS256
ACCESS_TOKEN_EXPIRE_MINUTES=120
REFRESH_TOKEN_EXPIRE_MINUTES=10080

# ==================== 内部服务认证（必需）====================
# 🔐 生成强密钥：python -c "import secrets; print(secrets.token_urlsafe(32))"
# ⚠️ 生产环境必须修改此密钥！不要使用示例密钥！
INTERNAL_API_KEY=PLEASE-CHANGE-ME-generate-your-own-internal-api-key-here

# ==================== AI大模型API（必需）====================
# 📌 获取地址：https://dashscope.console.aliyun.com/apiKey
# 获取步骤：
#   1. 访问 https://dashscope.console.aliyun.com/
#   2. 登录阿里云账号，开通 DashScope 服务
#   3. 在 API-KEY 管理页面创建密钥
#   4. 复制密钥到下方（格式：sk-xxxxxxxxxxxxxxxxxxxxxxxx）
# 文档：https://help.aliyun.com/zh/dashscope/developer-reference/activate-dashscope-and-create-an-api-key
DASHSCOPE_API_KEY=sk-your-dashscope-api-key-here

# 📌 关于 DASHSCOPE_API_KEY 的说明：
# DashScope 是阿里云的大模型服务平台，一个 API Key 可以同时访问多种服务：
#   - 知识库文档向量化（text-embedding-v4 模型）
#   - 通义千问聊天模型（qwen-turbo, qwen-plus, qwen-max 等）
#   - 多模态向量化（tongyi-embedding-vision-plus 等）
# 因此只需要配置一个 DASHSCOPE_API_KEY 即可满足上述所有功能需求。
# 如需为不同功能使用不同的 API Key，可以在下方"默认大模型配置"中单独设置 QWEN_API_KEY。

# ==================== 管理员账号自动创建（可选）====================
# 首次启动时自动创建管理员账号
# ⚠️ 如果不设置密码，系统将跳过管理员创建，需要手动注册

# 管理员用户名（默认：admin）
ADMIN_USERNAME=admin

# 管理员密码（必须设置才会自动创建，建议8位以上）
# 示例：ADMIN_PASSWORD=Admin@345678
ADMIN_PASSWORD=

# 管理员邮箱（可选，默认：{ADMIN_USERNAME}@aiot.com）
# ADMIN_EMAIL=admin@example.com

# ==================== 默认大模型配置（可选）====================
# 系统启动时自动创建的默认大模型（通义千问）
# 如果未配置，需要在界面中手动创建大模型

# 通义千问API密钥（可选）
# 如果未设置，将自动使用上面的 DASHSCOPE_API_KEY
# 适用场景：
#   - 需要为聊天模型和向量化使用不同的 API Key（不同账户、配额等）
#   - 需要单独管理聊天模型的 API 调用配额
#   - 测试环境与生产环境使用不同的 API Key
# QWEN_API_KEY=sk-your-qwen-api-key-here

# API地址（默认：https://dashscope.aliyuncs.com/compatible-mode/v1）
# QWEN_API_BASE=https://dashscope.aliyuncs.com/compatible-mode/v1

# 模型名称（默认：qwen-turbo，可选：qwen-plus, qwen-max）
# QWEN_MODEL_NAME=qwen-turbo

# 显示名称（默认：通义千问-Turbo）
# QWEN_DISPLAY_NAME=通义千问-Turbo

# 最大token数（默认：8192）
# QWEN_MAX_TOKENS=8192

# 温度参数（默认：0.20）
# QWEN_TEMPERATURE=0.20

# Top-p参数（默认：0.90）
# QWEN_TOP_P=0.90

# ==================== 默认产品配置（可选）====================
# 系统启动时会自动创建默认的产品配置（ESP32-S3开发板）
# 如果未配置，将使用默认值

# 产品编码（默认：ESP-32-S3-01）
# DEFAULT_PRODUCT_CODE=ESP-32-S3-01

# 产品名称（默认：标准开发板）
# DEFAULT_PRODUCT_NAME=标准开发板

# ==================== 环境配置 ====================
ENVIRONMENT=production
LOG_LEVEL=INFO

# ==================== 邮件服务配置（可选）====================
# 用于密码重置、通知等功能，不配置也能运行
# 📌 163邮箱配置示例（需要开启SMTP服务并使用授权码）

# 邮箱用户名
# MAIL_USERNAME=your-email@163.com

# 邮箱授权码（不是邮箱密码！需要在163邮箱设置中开启SMTP并生成授权码）
# MAIL_PASSWORD=your-authorization-code

# 发件人地址（通常与MAIL_USERNAME相同）
# MAIL_FROM=your-email@163.com

# SMTP服务器（默认：smtp.gmail.com，使用163邮箱需修改为smtp.163.com）
# MAIL_SERVER=smtp.163.com

# ==================== 插件服务配置 ====================
PLUGIN_CORS_ENABLED=true
PLUGIN_CORS_ORIGINS=*
PLUGIN_REQUEST_TIMEOUT=30
PLUGIN_DEBUG_MODE=false

# ==================== Flower监控配置 ====================
# Flower任务监控面板的访问认证
# 格式：用户名:密码
FLOWER_BASIC_AUTH=admin:admin

# ==================== 构建加速配置（可选）====================
# 如果构建镜像时网络较慢，可以启用国内镜像源加速
# 设置为 true 使用清华大学镜像源
USE_CHINA_MIRROR=false
# PIP_INDEX_URL=https://pypi.tuna.tsinghua.edu.cn/simple
# PIP_TRUSTED_HOST=pypi.tuna.tsinghua.edu.cn

# ==========================================
# 🚀 快速启动指南（外部数据库模式）
# ==========================================
# 📋 前置条件：准备外部MySQL数据库
# 
# 1. 确保MySQL服务正在运行（推荐版本：5.7.x 或 8.0.x）
#
# 2. 创建数据库：
#    mysql -h HOST -u root -p
#    CREATE DATABASE aiot_admin CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
#
# 3. 创建用户并授权：
#    CREATE USER 'aiot_user'@'%' IDENTIFIED BY 'your_secure_password';
#    GRANT ALL PRIVILEGES ON aiot_admin.* TO 'aiot_user'@'%';
#    FLUSH PRIVILEGES;
#
# 4. 导入数据库结构：
#    cd SQL
#    mysql -h HOST -u aiot_user -p aiot_admin < 01_init_database.sql
#    mysql -h HOST -u aiot_user -p aiot_admin < 02_init_data.sql
#
# 5. （可选）如需从旧数据库迁移：
#    mysql -h HOST -u aiot_user -p aiot_admin < migration_from_old_to_new.sql
#
# ==========================================
# 🔧 配置步骤
# ==========================================
# 1. 复制此文件：
#    cp docker/.env.external-db.example docker/.env
#
# 2. 修改必需配置：
#    ✅ EXTERNAL_DB_HOST（外部MySQL服务器地址）
#    ✅ EXTERNAL_DB_PORT（外部MySQL端口，默认3306）
#    ✅ EXTERNAL_DB_USER（数据库用户名）
#    ✅ EXTERNAL_DB_PASSWORD（数据库密码）
#    ✅ EXTERNAL_DB_NAME（数据库名称）
#    ✅ SECRET_KEY（生产环境必须修改！）
#    ✅ INTERNAL_API_KEY（生产环境必须修改！）
#    ✅ DEVICE_MQTT_BROKER（设备连接的MQTT地址，必填！）
#    📌 DASHSCOPE_API_KEY（如需使用AI功能，建议设置）
#    📌 ADMIN_PASSWORD（首次部署建议设置，自动创建管理员账号）
#
# 3. 启动服务（推荐使用部署脚本）：
#    ./script/deploy.sh deploy-external-db
#
# 4. 或手动启动：
#    cd docker
#    docker-compose -f docker-compose.external-db.yml up -d
#
# 5. 查看服务状态：
#    cd docker
#    docker-compose -f docker-compose.external-db.yml ps
#
# 6. 查看日志：
#    cd docker
#    docker-compose -f docker-compose.external-db.yml logs -f [服务名]
#    # 示例：查看后端日志
#    docker-compose -f docker-compose.external-db.yml logs -f backend
#
# 📍 服务访问地址：
#   - 前端：http://localhost:80
#   - 后端API：http://localhost:8000
#   - API文档：http://localhost:8000/docs
#   - Celery监控：http://localhost:5555
#   - 插件服务：http://localhost:9000
#   - 配置服务：http://localhost:8001
#
# 📚 详细文档：
#   - 部署文档：../deploy/docs/docker-deployment.md
#   - 外部数据库部署指南：../deploy/docs/manual-deployment.md
#   - 环境配置说明：../docs_技术文档/03_部署运维/环境配置.md
#
# ⚠️ 注意事项：
#   1. 确保外部MySQL允许Docker容器网络访问（检查防火墙和MySQL绑定地址）
#   2. 生产环境务必修改所有标记"CHANGE-ME"的密钥
#   3. 建议定期备份外部数据库
#   4. 监控数据库连接数和性能指标
# ==========================================
