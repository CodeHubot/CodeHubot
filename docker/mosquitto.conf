# ==========================================
# Mosquitto MQTT Broker 配置文件
# CodeHubot 物联网设备服务系统
# ==========================================

# ==================== 基本配置 ====================
# 进程名称
pid_file /mosquitto/data/mosquitto.pid

# ==================== 监听配置 ====================
# 监听端口（标准MQTT端口）
# 监听所有网络接口（0.0.0.0表示所有接口）
# 如果只需要本地访问，可以改为 127.0.0.1
listener 1883 0.0.0.0

# 最大数据包大小（字节，默认256MB）
max_packet_size 268435456

# ==================== 认证配置 ====================
# 允许匿名访问（生产环境建议改为false并配置用户认证）
allow_anonymous true

# 如果启用认证，取消下面的注释并配置密码文件
# allow_anonymous false
# password_file /mosquitto/config/passwd
# acl_file /mosquitto/config/acl

# ==================== 持久化配置 ====================
# 启用持久化（保存订阅和消息）
persistence true

# 持久化数据存储位置
persistence_location /mosquitto/data/

# 持久化文件名称
persistence_file mosquitto.db

# 自动保存间隔（秒，0表示禁用自动保存）
autosave_interval 1800

# ==================== 日志配置 ====================
# 日志输出到标准输出（Docker容器推荐）
log_dest stdout

# 日志类型（可以组合使用）
log_type error
log_type warning
log_type notice
log_type information
# log_type all  # 记录所有日志（调试时使用）

# 日志时间戳格式
log_timestamp true
log_timestamp_format %Y-%m-%d %H:%M:%S

# ==================== 性能配置 ====================
# 消息队列大小（每个客户端）
max_queued_messages 1000

# 保留消息数量限制（每个主题，正在传输中的消息数）
max_inflight_messages 20

# 最大消息大小（字节，0表示无限制）
message_size_limit 0

# ==================== 连接配置 ====================
# 连接超时时间（秒）
connection_timeout 60

# Keepalive时间（秒，客户端心跳间隔）
keepalive_interval 60

# 清理会话（客户端断开后是否保留订阅）
# persistent_client_expiration 0

# ==================== 主题配置 ====================
# 系统主题前缀（用于Mosquitto内部主题）
sys_interval 10

# ==================== 安全配置 ====================
# 允许零长度客户端ID
allow_zero_length_clientid true

# 自动生成客户端ID前缀（如果客户端未提供ID，使用此前缀）
# 如果需要自动生成，取消注释并设置前缀，例如：auto_id_prefix mqtt_client_
# auto_id_prefix

# ==================== 网络配置 ====================
# 最大并发连接数（-1表示无限制，根据实际需求调整）
max_connections -1

# ==================== 说明 ====================
# 1. 当前配置允许匿名访问，适合开发和测试环境
# 2. 生产环境建议：
#    - 设置 allow_anonymous false
#    - 创建密码文件：mosquitto_passwd -c /mosquitto/config/passwd username
#    - 配置ACL文件控制主题访问权限
# 3. 主题结构：
#    - devices/{device_uuid}/data      # 设备数据
#    - devices/{device_uuid}/status    # 设备状态
#    - devices/{device_uuid}/heartbeat # 心跳
#    - devices/{device_uuid}/control   # 控制命令
# 4. 日志级别说明：
#    - error: 仅错误
#    - warning: 警告和错误
#    - notice: 通知、警告和错误
#    - information: 所有信息（推荐）
#    - all: 所有日志（包括调试信息）
