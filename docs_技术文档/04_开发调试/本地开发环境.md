# æœ¬åœ°å¼€å‘ç¯å¢ƒ

## æ¦‚è¿°

æœ¬æ–‡æ¡£ä»‹ç»å¦‚ä½•åœ¨æœ¬åœ°æ­å»º CodeHubot å¹³å°çš„å¼€å‘ç¯å¢ƒï¼ŒåŒ…æ‹¬å‰ç«¯ã€åç«¯ã€æ•°æ®åº“ç­‰å„ä¸ªæ¨¡å—çš„é…ç½®ã€‚

## ç¯å¢ƒè¦æ±‚

### æ“ä½œç³»ç»Ÿ

- âœ… macOS 10.15+
- âœ… Linux (Ubuntu 20.04+, CentOS 8+)
- âœ… Windows 10/11 (æ¨è WSL2)

### å¿…éœ€è½¯ä»¶

| è½¯ä»¶ | ç‰ˆæœ¬è¦æ±‚ | ç”¨é€” |
|------|---------|------|
| **Python** | 3.11+ | åç«¯è¿è¡Œç¯å¢ƒ |
| **Node.js** | 18+ | å‰ç«¯æ„å»ºå·¥å…· |
| **npm/pnpm** | 8+/8+ | åŒ…ç®¡ç†å™¨ |
| **MySQL** | 8.0+ | æ•°æ®åº“ |
| **Redis** | 7+ | ç¼“å­˜æœåŠ¡ |
| **Git** | 2.x | ç‰ˆæœ¬æ§åˆ¶ |

### æ¨èè½¯ä»¶

- **Docker Desktop**: å®¹å™¨åŒ–éƒ¨ç½²ï¼ˆå¯é€‰ä½†æ¨èï¼‰
- **VS Code**: ä»£ç ç¼–è¾‘å™¨
- **Postman/Apifox**: API æµ‹è¯•å·¥å…·
- **TablePlus/DBeaver**: æ•°æ®åº“ç®¡ç†å·¥å…·

## å¿«é€Ÿå¼€å§‹

### 1. å…‹éš†é¡¹ç›®

```bash
# å…‹éš†ä»“åº“
git clone https://github.com/CodeHubot/CodeHubot.git

# è¿›å…¥é¡¹ç›®ç›®å½•
cd CodeHubot
```

### 2. ä½¿ç”¨ Docker å¿«é€Ÿå¯åŠ¨ï¼ˆæ¨èï¼‰

```bash
# å¤åˆ¶ç¯å¢ƒå˜é‡é…ç½®
cp backend/env.example backend/.env

# ç¼–è¾‘ .env æ–‡ä»¶ï¼Œé…ç½®å¿…è¦å‚æ•°
nano backend/.env

# ä¸€é”®å¯åŠ¨æ‰€æœ‰æœåŠ¡
./deploy.sh
```

**è®¿é—®åœ°å€**ï¼š
- å‰ç«¯: http://localhost:3000
- åç«¯ API: http://localhost:8000
- API æ–‡æ¡£: http://localhost:8000/docs

### 3. æ‰‹åŠ¨é…ç½®å¼€å‘ç¯å¢ƒ

å¦‚æœä¸ä½¿ç”¨ Dockerï¼ŒæŒ‰ä»¥ä¸‹æ­¥éª¤æ‰‹åŠ¨é…ç½®ã€‚

## åç«¯å¼€å‘ç¯å¢ƒ

### 1. å®‰è£… Python ä¾èµ–

```bash
# è¿›å…¥åç«¯ç›®å½•
cd backend

# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
python3 -m venv venv

# æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
# macOS/Linux:
source venv/bin/activate
# Windows:
venv\Scripts\activate

# å®‰è£…ä¾èµ–
pip install -r requirements.txt
```

### 2. é…ç½®ç¯å¢ƒå˜é‡

```bash
# å¤åˆ¶ç¤ºä¾‹é…ç½®
cp env.example .env

# ç¼–è¾‘é…ç½®æ–‡ä»¶
nano .env
```

**å¿…å¡«é…ç½®é¡¹**:

```bash
# æ•°æ®åº“é…ç½®
DB_HOST=localhost
DB_PORT=3306
DB_USER=root
DB_PASSWORD=your-password
DB_NAME=aiot_admin

# Redis é…ç½®
REDIS_HOST=localhost
REDIS_PORT=6379

# JWT é…ç½®
SECRET_KEY=your-secret-key-change-this
ALGORITHM=HS256
ACCESS_TOKEN_EXPIRE_MINUTES=1440

# MQTT é…ç½®
MQTT_BROKER_HOST=localhost
MQTT_BROKER_PORT=1883

# åº”ç”¨é…ç½®
DEBUG=true
CORS_ORIGINS=["http://localhost:3000"]
```

### 3. åˆå§‹åŒ–æ•°æ®åº“

```bash
# åˆ›å»ºæ•°æ®åº“
mysql -u root -p -e "CREATE DATABASE IF NOT EXISTS aiot_admin CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;"

# å¯¼å…¥æ•°æ®åº“ç»“æ„
mysql -u root -p aiot_admin < ../SQL/init_database.sql
```

### 4. å¯åŠ¨åç«¯æœåŠ¡

```bash
# å¼€å‘æ¨¡å¼ï¼ˆçƒ­é‡è½½ï¼‰
uvicorn main:app --reload --host 0.0.0.0 --port 8000

# æˆ–è€…ä½¿ç”¨å¿«æ·å‘½ä»¤
python main.py
```

**éªŒè¯è¿è¡Œ**ï¼š
```bash
# è®¿é—® API æ–‡æ¡£
open http://localhost:8000/docs

# å¥åº·æ£€æŸ¥
curl http://localhost:8000/health
```

### 5. å¯åŠ¨ Celery å¼‚æ­¥ä»»åŠ¡ï¼ˆå¯é€‰ï¼‰

```bash
# æ–°å¼€ç»ˆç«¯ï¼Œè¿›å…¥é¡¹ç›®ç›®å½•
cd service/celery-service

# å¯åŠ¨ Celery Worker
celery -A celery_app worker --loglevel=info

# å¯åŠ¨ Celery Beatï¼ˆå®šæ—¶ä»»åŠ¡ï¼‰
celery -A celery_app beat --loglevel=info
```

## å‰ç«¯å¼€å‘ç¯å¢ƒ

### 1. å®‰è£… Node.js ä¾èµ–

```bash
# è¿›å…¥å‰ç«¯ç›®å½•
cd frontend

# å®‰è£…ä¾èµ–ï¼ˆä½¿ç”¨ npmï¼‰
npm install

# æˆ–ä½¿ç”¨ pnpmï¼ˆæ›´å¿«ï¼‰
pnpm install
```

### 2. é…ç½®å¼€å‘ç¯å¢ƒ

å‰ç«¯ä½¿ç”¨ Viteï¼Œé…ç½®æ–‡ä»¶åœ¨ `vite.config.js`ï¼š

```javascript
import { defineConfig } from 'vite'
import vue from '@vitejs/plugin-vue'

export default defineConfig({
  plugins: [vue()],
  server: {
    port: 3000,
    proxy: {
      '/api': {
        target: 'http://localhost:8000',
        changeOrigin: true
      }
    }
  },
  resolve: {
    alias: {
      '@': '/src'
    }
  }
})
```

### 3. å¯åŠ¨å‰ç«¯æœåŠ¡

```bash
# å¼€å‘æ¨¡å¼ï¼ˆçƒ­é‡è½½ï¼‰
npm run dev

# æˆ–
pnpm dev
```

**è®¿é—®åœ°å€**: http://localhost:3000

### 4. æ„å»ºç”Ÿäº§ç‰ˆæœ¬

```bash
# æ„å»º
npm run build

# é¢„è§ˆæ„å»ºç»“æœ
npm run preview
```

## æ•°æ®åº“ç¯å¢ƒ

### ä½¿ç”¨ Docker å¯åŠ¨ MySQL

```bash
# å¯åŠ¨ MySQL å®¹å™¨
docker run -d \
  --name codehubot-mysql \
  -p 3306:3306 \
  -e MYSQL_ROOT_PASSWORD=root_password \
  -e MYSQL_DATABASE=aiot_admin \
  -e MYSQL_USER=aiot_user \
  -e MYSQL_PASSWORD=aiot_password \
  -v mysql_data:/var/lib/mysql \
  mysql:8.0 \
  --default-authentication-plugin=mysql_native_password
```

### æœ¬åœ°å®‰è£… MySQL

#### macOS (Homebrew)

```bash
# å®‰è£…
brew install mysql

# å¯åŠ¨æœåŠ¡
brew services start mysql

# å®‰å…¨é…ç½®
mysql_secure_installation
```

#### Ubuntu/Debian

```bash
# å®‰è£…
sudo apt update
sudo apt install mysql-server

# å¯åŠ¨æœåŠ¡
sudo systemctl start mysql
sudo systemctl enable mysql

# å®‰å…¨é…ç½®
sudo mysql_secure_installation
```

### æ•°æ®åº“ç®¡ç†å·¥å…·

**æ¨èå·¥å…·**:
- **TablePlus**: ç°ä»£åŒ– GUI å·¥å…·ï¼ˆmacOS/Windows/Linuxï¼‰
- **DBeaver**: å…è´¹å¼€æºï¼ˆè·¨å¹³å°ï¼‰
- **MySQL Workbench**: å®˜æ–¹å·¥å…·
- **Sequel Ace**: macOS ä¸“ç”¨

## Redis ç¯å¢ƒ

### ä½¿ç”¨ Docker å¯åŠ¨ Redis

```bash
# å¯åŠ¨ Redis å®¹å™¨
docker run -d \
  --name codehubot-redis \
  -p 6379:6379 \
  -v redis_data:/data \
  redis:7-alpine \
  redis-server --appendonly yes
```

### æœ¬åœ°å®‰è£… Redis

#### macOS (Homebrew)

```bash
# å®‰è£…
brew install redis

# å¯åŠ¨æœåŠ¡
brew services start redis

# æµ‹è¯•è¿æ¥
redis-cli ping
```

#### Ubuntu/Debian

```bash
# å®‰è£…
sudo apt update
sudo apt install redis-server

# å¯åŠ¨æœåŠ¡
sudo systemctl start redis
sudo systemctl enable redis

# æµ‹è¯•è¿æ¥
redis-cli ping
```

## MQTT ç¯å¢ƒ

### ä½¿ç”¨ Docker å¯åŠ¨ Mosquitto

```bash
# å¯åŠ¨ Mosquitto å®¹å™¨
docker run -d \
  --name codehubot-mqtt \
  -p 1883:1883 \
  -p 9001:9001 \
  -v $(pwd)/docker/mosquitto.conf:/mosquitto/config/mosquitto.conf \
  eclipse-mosquitto:2.0
```

### æœ¬åœ°å®‰è£… Mosquitto

#### macOS (Homebrew)

```bash
# å®‰è£…
brew install mosquitto

# å¯åŠ¨æœåŠ¡
brew services start mosquitto
```

#### Ubuntu/Debian

```bash
# å®‰è£…
sudo apt update
sudo apt install mosquitto mosquitto-clients

# å¯åŠ¨æœåŠ¡
sudo systemctl start mosquitto
sudo systemctl enable mosquitto
```

### æµ‹è¯• MQTT

```bash
# è®¢é˜…ä¸»é¢˜
mosquitto_sub -h localhost -t "test" -v

# å‘å¸ƒæ¶ˆæ¯ï¼ˆæ–°å¼€ç»ˆç«¯ï¼‰
mosquitto_pub -h localhost -t "test" -m "Hello MQTT"
```

## IDE é…ç½®

### VS Code æ¨èé…ç½®

#### å®‰è£…æ‰©å±•

**Python å¼€å‘**:
- Python
- Pylance
- Python Indent
- autoDocstring

**Vue å¼€å‘**:
- Vue Language Features (Volar)
- TypeScript Vue Plugin (Volar)
- ESLint
- Prettier

**é€šç”¨å·¥å…·**:
- GitLens
- Docker
- REST Client

#### å·¥ä½œåŒºè®¾ç½®

åˆ›å»º `.vscode/settings.json`:

```json
{
  "python.defaultInterpreterPath": "${workspaceFolder}/backend/venv/bin/python",
  "python.linting.enabled": true,
  "python.linting.pylintEnabled": false,
  "python.linting.flake8Enabled": true,
  "python.formatting.provider": "black",
  "editor.formatOnSave": true,
  "editor.codeActionsOnSave": {
    "source.fixAll.eslint": true
  },
  "[python]": {
    "editor.defaultFormatter": "ms-python.black-formatter",
    "editor.formatOnSave": true
  },
  "[vue]": {
    "editor.defaultFormatter": "esbenp.prettier-vscode"
  },
  "[javascript]": {
    "editor.defaultFormatter": "esbenp.prettier-vscode"
  }
}
```

#### è°ƒè¯•é…ç½®

åˆ›å»º `.vscode/launch.json`:

```json
{
  "version": "0.2.0",
  "configurations": [
    {
      "name": "Python: FastAPI",
      "type": "python",
      "request": "launch",
      "module": "uvicorn",
      "args": [
        "main:app",
        "--reload",
        "--host",
        "0.0.0.0",
        "--port",
        "8000"
      ],
      "cwd": "${workspaceFolder}/backend",
      "env": {
        "PYTHONPATH": "${workspaceFolder}/backend"
      }
    },
    {
      "name": "Vue: Chrome",
      "type": "chrome",
      "request": "launch",
      "url": "http://localhost:3000",
      "webRoot": "${workspaceFolder}/frontend/src"
    }
  ]
}
```

## ç¯å¢ƒå˜é‡ç®¡ç†

### ç¯å¢ƒå˜é‡æ–‡ä»¶

```bash
backend/
â”œâ”€â”€ .env                  # æœ¬åœ°å¼€å‘ç¯å¢ƒï¼ˆä¸æäº¤ï¼‰
â”œâ”€â”€ .env.example          # ç¤ºä¾‹é…ç½®ï¼ˆæäº¤ï¼‰
â”œâ”€â”€ .env.test             # æµ‹è¯•ç¯å¢ƒ
â””â”€â”€ .env.production       # ç”Ÿäº§ç¯å¢ƒ
```

### åŠ è½½ç¯å¢ƒå˜é‡

Python ä½¿ç”¨ `python-dotenv`:

```python
from dotenv import load_dotenv
import os

# åŠ è½½ .env æ–‡ä»¶
load_dotenv()

# è¯»å–ç¯å¢ƒå˜é‡
db_host = os.getenv("DB_HOST", "localhost")
```

ä½¿ç”¨ Pydantic Settingsï¼ˆæ¨èï¼‰:

```python
from pydantic_settings import BaseSettings

class Settings(BaseSettings):
    db_host: str = "localhost"
    db_port: int = 3306
    
    class Config:
        env_file = ".env"

settings = Settings()
```

## å¸¸ç”¨å¼€å‘å‘½ä»¤

### åç«¯

```bash
# å¯åŠ¨å¼€å‘æœåŠ¡å™¨
uvicorn main:app --reload

# è¿è¡Œæµ‹è¯•
pytest

# ä»£ç æ ¼å¼åŒ–
black .

# ä»£ç æ£€æŸ¥
flake8 app/

# ç”Ÿæˆä¾èµ–æ–‡ä»¶
pip freeze > requirements.txt

# æ•°æ®åº“è¿ç§»ï¼ˆå¦‚æœä½¿ç”¨ Alembicï¼‰
alembic revision --autogenerate -m "æè¿°"
alembic upgrade head
```

### å‰ç«¯

```bash
# å¯åŠ¨å¼€å‘æœåŠ¡å™¨
npm run dev

# æ„å»ºç”Ÿäº§ç‰ˆæœ¬
npm run build

# ä»£ç æ£€æŸ¥
npm run lint

# ä»£ç æ ¼å¼åŒ–
npm run format

# ä¾èµ–æ›´æ–°
npm update
```

### Docker

```bash
# å¯åŠ¨æ‰€æœ‰æœåŠ¡
docker-compose up -d

# æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f backend

# é‡å¯æœåŠ¡
docker-compose restart backend

# åœæ­¢å¹¶åˆ é™¤å®¹å™¨
docker-compose down

# è¿›å…¥å®¹å™¨
docker exec -it codehubot-backend bash
```

## æ•°æ®åº“åˆå§‹åŒ–è„šæœ¬

åˆ›å»ºåˆå§‹åŒ–è„šæœ¬ `scripts/init_dev_db.sh`:

```bash
#!/bin/bash

echo "ğŸ—„ï¸  åˆå§‹åŒ–å¼€å‘æ•°æ®åº“..."

# æ•°æ®åº“é…ç½®
DB_HOST="localhost"
DB_USER="root"
DB_PASSWORD="your-password"
DB_NAME="aiot_admin"

# åˆ›å»ºæ•°æ®åº“
mysql -h $DB_HOST -u $DB_USER -p$DB_PASSWORD -e "CREATE DATABASE IF NOT EXISTS $DB_NAME CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;"

# å¯¼å…¥åˆå§‹åŒ–è„šæœ¬
mysql -h $DB_HOST -u $DB_USER -p$DB_PASSWORD $DB_NAME < ../SQL/init_database.sql

# å¯¼å…¥æµ‹è¯•æ•°æ®ï¼ˆå¯é€‰ï¼‰
if [ -f "test_data.sql" ]; then
    mysql -h $DB_HOST -u $DB_USER -p$DB_PASSWORD $DB_NAME < test_data.sql
fi

echo "âœ… æ•°æ®åº“åˆå§‹åŒ–å®Œæˆï¼"
```

## æµ‹è¯•æ•°æ®ç”Ÿæˆ

åˆ›å»ºæµ‹è¯•æ•°æ®è„šæœ¬ `scripts/generate_test_data.py`:

```python
#!/usr/bin/env python3
"""ç”Ÿæˆæµ‹è¯•æ•°æ®"""

from backend.app.core.database import SessionLocal
from backend.app.models.user import User
from backend.app.core.security import get_password_hash

def create_test_users():
    """åˆ›å»ºæµ‹è¯•ç”¨æˆ·"""
    db = SessionLocal()
    
    users = [
        {
            "email": "admin@test.com",
            "username": "admin",
            "password": "admin123",
            "role": "admin"
        },
        {
            "email": "teacher@test.com",
            "username": "teacher",
            "password": "teacher123",
            "role": "teacher"
        },
        {
            "email": "student@test.com",
            "username": "student",
            "password": "student123",
            "role": "student"
        }
    ]
    
    for user_data in users:
        # æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å­˜åœ¨
        existing = db.query(User).filter(User.email == user_data["email"]).first()
        if not existing:
            user = User(
                email=user_data["email"],
                username=user_data["username"],
                password_hash=get_password_hash(user_data["password"]),
                role=user_data["role"],
                is_active=True
            )
            db.add(user)
            print(f"âœ… åˆ›å»ºæµ‹è¯•ç”¨æˆ·: {user_data['username']}")
    
    db.commit()
    db.close()

if __name__ == "__main__":
    create_test_users()
    print("âœ… æµ‹è¯•æ•°æ®ç”Ÿæˆå®Œæˆï¼")
```

## å¸¸è§é—®é¢˜

### 1. Python ç‰ˆæœ¬ä¸åŒ¹é…

```bash
# ä½¿ç”¨ pyenv ç®¡ç† Python ç‰ˆæœ¬
brew install pyenv

# å®‰è£… Python 3.11
pyenv install 3.11.0

# è®¾ç½®é¡¹ç›® Python ç‰ˆæœ¬
cd backend
pyenv local 3.11.0
```

### 2. ç«¯å£è¢«å ç”¨

```bash
# æŸ¥çœ‹ç«¯å£å ç”¨
lsof -i:8000

# æ€æ­»è¿›ç¨‹
kill -9 <PID>

# æˆ–ä¿®æ”¹é…ç½®ä½¿ç”¨å…¶ä»–ç«¯å£
uvicorn main:app --reload --port 8001
```

### 3. æ•°æ®åº“è¿æ¥å¤±è´¥

```bash
# æ£€æŸ¥ MySQL æ˜¯å¦è¿è¡Œ
brew services list

# é‡å¯ MySQL
brew services restart mysql

# æµ‹è¯•è¿æ¥
mysql -u root -p -e "SELECT 1"
```

### 4. å‰ç«¯ä¾èµ–å®‰è£…å¤±è´¥

```bash
# æ¸…é™¤ç¼“å­˜
npm cache clean --force

# åˆ é™¤ node_modules
rm -rf node_modules package-lock.json

# é‡æ–°å®‰è£…
npm install
```

### 5. CORS è·¨åŸŸé—®é¢˜

åœ¨ `backend/main.py` ä¸­é…ç½®ï¼š

```python
app.add_middleware(
    CORSMiddleware,
    allow_origins=["http://localhost:3000"],  # æ·»åŠ å‰ç«¯åœ°å€
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)
```

## ä¸‹ä¸€æ­¥

- [è°ƒè¯•æŠ€å·§](./è°ƒè¯•æŠ€å·§.md) - å­¦ä¹ è°ƒè¯•æ–¹æ³•
- [APIæµ‹è¯•](./APIæµ‹è¯•.md) - æ¥å£æµ‹è¯•å·¥å…·å’Œæ–¹æ³•
- [å¸¸è§é—®é¢˜æ’æŸ¥](./å¸¸è§é—®é¢˜æ’æŸ¥.md) - é—®é¢˜è¯Šæ–­æŒ‡å—

## ç›¸å…³æ–‡æ¡£

- [æ•´ä½“æ¶æ„è®¾è®¡](../02_ç³»ç»Ÿæ¶æ„/æ•´ä½“æ¶æ„è®¾è®¡.md) - äº†è§£ç³»ç»Ÿæ¶æ„
- [Dockerå®¹å™¨åŒ–éƒ¨ç½²](../03_éƒ¨ç½²è¿ç»´/Dockerå®¹å™¨åŒ–éƒ¨ç½².md) - Docker éƒ¨ç½²æ–¹æ¡ˆ
- [APIå¼€å‘è§„èŒƒ](../../docs_å¼€å‘è§„èŒƒ/01_APIå¼€å‘è§„èŒƒ.md) - API å¼€å‘è§„èŒƒ
