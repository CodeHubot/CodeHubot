# 数据库设计

## 概述

CodeHubot 系统采用 MySQL 关系型数据库，使用模块化设计，支持多业务模块和复杂关联关系。本文档详细介绍数据库设计规范、表结构和最佳实践，适合教学和实际开发使用。

## 数据库规范

### 基础配置

```sql
-- 数据库版本: MySQL 5.7.x, 8.0.x
-- 字符集: utf8mb4
-- 排序规则: utf8mb4_unicode_ci
-- 存储引擎: InnoDB

CREATE DATABASE aiot_admin 
  CHARACTER SET utf8mb4 
  COLLATE utf8mb4_unicode_ci;
```

### 命名规范

#### 表命名规范

```
-- 格式: {模块}_{功能}
-- 示例:
core_users          -- 核心模块：用户表
core_schools        -- 核心模块：学校表
device_main         -- 设备模块：设备主表
device_products     -- 设备模块：产品表
agent_main          -- 智能体模块：智能体表
kb_knowledge_bases  -- 知识库模块：知识库表
pbl_courses         -- PBL模块：课程表
```

**模块前缀**：
- `core_` - 核心模块（用户、学校）
- `device_` - 设备模块
- `agent_` - AI 智能体模块
- `kb_` - 知识库模块
- `llm_` - 大模型模块
- `plugin_` - 插件模块
- `workflow_` - 工作流模块
- `pbl_` - PBL 教学模块

#### 字段命名规范

```sql
-- 主键: id (INT AUTO_INCREMENT)
id INT(11) NOT NULL AUTO_INCREMENT PRIMARY KEY

-- UUID: uuid (CHAR(36))
uuid CHAR(36) NOT NULL COMMENT 'UUID'

-- 外键: {关联表}_{id}
user_id INT(11) COMMENT '用户ID'
school_id INT(11) COMMENT '学校ID'

-- 布尔: is_{属性} 或 has_{属性}
is_active TINYINT(1) DEFAULT 1 COMMENT '是否激活'
has_permission TINYINT(1) DEFAULT 0 COMMENT '是否有权限'

-- 时间戳
created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间'
updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间'
deleted_at DATETIME DEFAULT NULL COMMENT '软删除时间'

-- 状态: {功能}_status
embedding_status ENUM('pending', 'processing', 'completed', 'failed') COMMENT '向量化状态'
```

### 字段类型规范

| 数据类型 | 用途 | 示例 |
|---------|------|------|
| **INT(11)** | 主键、外键、计数 | `id`, `user_id`, `count` |
| **CHAR(36)** | UUID | `uuid` |
| **VARCHAR(50)** | 短文本（代码、标识） | `username`, `device_id` |
| **VARCHAR(255)** | 中等文本（邮箱、URL） | `email`, `url` |
| **TEXT** | 长文本 | `description`, `content` |
| **LONGTEXT** | 超长文本（JSON） | `config`, `metadata` |
| **ENUM** | 枚举值 | `role`, `status` |
| **TINYINT(1)** | 布尔值 | `is_active`, `online` |
| **DATETIME** | 日期时间 | `created_at`, `last_seen` |
| **DECIMAL(10,7)** | 精确小数 | `latitude`, `longitude` |
| **JSON** | JSON 数据 | `settings`, `options` (MySQL 5.7.8+) |

## 核心模块

### 1. 用户表 (core_users)

```sql
CREATE TABLE `core_users` (
  `id` INT(11) NOT NULL AUTO_INCREMENT PRIMARY KEY,
  
  -- 登录信息
  `email` VARCHAR(255) DEFAULT NULL COMMENT '邮箱',
  `phone` VARCHAR(20) DEFAULT NULL COMMENT '电话',
  `username` VARCHAR(50) NOT NULL COMMENT '用户名',
  `password_hash` VARCHAR(255) NOT NULL COMMENT '密码哈希',
  
  -- 个人信息
  `nickname` VARCHAR(50) DEFAULT NULL COMMENT '昵称',
  `real_name` VARCHAR(100) DEFAULT NULL COMMENT '真实姓名',
  `gender` ENUM('male','female','other') DEFAULT NULL COMMENT '性别',
  
  -- 角色权限
  `role` VARCHAR(50) NOT NULL DEFAULT 'individual' 
    COMMENT '角色：admin/channel/teacher/student/individual',
  
  -- 组织关系
  `school_id` INT(11) DEFAULT NULL COMMENT '所属学校ID',
  `class_id` INT(11) DEFAULT NULL COMMENT '所属班级ID',
  `group_id` INT(11) DEFAULT NULL COMMENT '所属小组ID',
  
  -- 教师信息
  `teacher_number` VARCHAR(50) DEFAULT NULL COMMENT '教师工号',
  `subject` VARCHAR(50) DEFAULT NULL COMMENT '教师学科',
  
  -- 学生信息
  `student_number` VARCHAR(50) DEFAULT NULL COMMENT '学号',
  
  -- 状态信息
  `is_active` TINYINT(1) NOT NULL DEFAULT 1 COMMENT '是否激活',
  `need_change_password` TINYINT(1) DEFAULT 0 COMMENT '需修改密码',
  `last_login` DATETIME DEFAULT NULL COMMENT '最后登录时间',
  `last_login_ip` VARCHAR(50) DEFAULT NULL COMMENT '最后登录IP',
  
  -- 时间戳
  `created_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `updated_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  `deleted_at` DATETIME DEFAULT NULL COMMENT '软删除',
  
  -- 索引
  UNIQUE KEY `uk_email` (`email`),
  UNIQUE KEY `uk_username` (`username`),
  KEY `idx_school_id` (`school_id`),
  KEY `idx_role` (`role`),
  KEY `idx_deleted_at` (`deleted_at`)
  
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci 
COMMENT='用户表';
```

**设计要点**：
- ✅ 支持多种角色（管理员、教师、学生等）
- ✅ 软删除（`deleted_at`）
- ✅ 密码哈希存储（bcrypt）
- ✅ 最后登录记录
- ✅ 支持组织层级（学校 > 班级 > 小组）

### 2. 学校表 (core_schools)

```sql
CREATE TABLE `core_schools` (
  `id` INT(11) NOT NULL AUTO_INCREMENT PRIMARY KEY,
  `uuid` CHAR(36) NOT NULL COMMENT 'UUID',
  
  -- 基本信息
  `school_code` VARCHAR(50) NOT NULL COMMENT '学校代码',
  `school_name` VARCHAR(200) NOT NULL COMMENT '学校名称',
  
  -- 地址信息
  `province` VARCHAR(50) DEFAULT NULL COMMENT '省份',
  `city` VARCHAR(50) DEFAULT NULL COMMENT '城市',
  `district` VARCHAR(50) DEFAULT NULL COMMENT '区/县',
  `address` VARCHAR(500) DEFAULT NULL COMMENT '详细地址',
  
  -- 联系信息
  `contact_person` VARCHAR(100) DEFAULT NULL COMMENT '联系人',
  `contact_phone` VARCHAR(20) DEFAULT NULL COMMENT '联系电话',
  `contact_email` VARCHAR(255) DEFAULT NULL COMMENT '联系邮箱',
  
  -- 授权信息
  `is_active` TINYINT(1) DEFAULT 1 COMMENT '是否激活',
  `license_expire_at` DATE DEFAULT NULL COMMENT '授权到期日期',
  `max_teachers` INT(11) DEFAULT NULL COMMENT '最大教师数',
  `max_students` INT(11) DEFAULT NULL COMMENT '最大学生数',
  `max_devices` INT(11) DEFAULT NULL COMMENT '最大设备数',
  
  -- 统计信息
  `current_teachers` INT(11) DEFAULT 0 COMMENT '当前教师数',
  `current_students` INT(11) DEFAULT 0 COMMENT '当前学生数',
  
  -- 管理员
  `admin_user_id` INT(11) DEFAULT NULL COMMENT '管理员ID',
  
  -- 时间戳
  `created_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `updated_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  
  -- 索引
  UNIQUE KEY `uk_uuid` (`uuid`),
  UNIQUE KEY `uk_school_code` (`school_code`),
  KEY `idx_is_active` (`is_active`),
  
  -- 外键
  FOREIGN KEY (`admin_user_id`) REFERENCES `core_users`(`id`) 
    ON DELETE SET NULL
  
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci 
COMMENT='学校表';
```

## 设备模块

### 设备主表 (device_main)

```sql
CREATE TABLE `device_main` (
  `id` INT(11) NOT NULL AUTO_INCREMENT PRIMARY KEY,
  `uuid` VARCHAR(36) NOT NULL COMMENT '设备UUID',
  `device_id` VARCHAR(50) NOT NULL COMMENT '设备ID（唯一标识）',
  
  -- 关联信息
  `product_id` INT(11) DEFAULT NULL COMMENT '产品ID',
  `user_id` INT(11) DEFAULT NULL COMMENT '所有者ID',
  `school_id` INT(11) DEFAULT NULL COMMENT '所属学校ID',
  
  -- 基本信息
  `name` VARCHAR(100) NOT NULL COMMENT '设备名称',
  `device_type` VARCHAR(50) DEFAULT NULL COMMENT '设备类型',
  `description` TEXT DEFAULT NULL COMMENT '设备描述',
  
  -- 状态信息
  `online` TINYINT(1) DEFAULT 0 COMMENT '是否在线',
  `last_seen` DATETIME DEFAULT NULL COMMENT '最后在线时间',
  
  -- 位置信息
  `location` VARCHAR(255) DEFAULT NULL COMMENT '位置描述',
  `latitude` DECIMAL(10,7) DEFAULT NULL COMMENT '纬度',
  `longitude` DECIMAL(10,7) DEFAULT NULL COMMENT '经度',
  
  -- 配置信息
  `config` LONGTEXT DEFAULT NULL COMMENT '设备配置（JSON）',
  `metadata` LONGTEXT DEFAULT NULL COMMENT '元数据（JSON）',
  
  -- 时间戳
  `created_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `updated_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  
  -- 索引
  UNIQUE KEY `uk_uuid` (`uuid`),
  UNIQUE KEY `uk_device_id` (`device_id`),
  KEY `idx_product_id` (`product_id`),
  KEY `idx_user_id` (`user_id`),
  KEY `idx_school_id` (`school_id`),
  KEY `idx_online` (`online`),
  
  -- 外键
  FOREIGN KEY (`product_id`) REFERENCES `device_products`(`id`) 
    ON DELETE SET NULL,
  FOREIGN KEY (`user_id`) REFERENCES `core_users`(`id`) 
    ON DELETE CASCADE,
  FOREIGN KEY (`school_id`) REFERENCES `core_schools`(`id`) 
    ON DELETE SET NULL
  
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci 
COMMENT='设备主表';
```

### 设备产品表 (device_products)

```sql
CREATE TABLE `device_products` (
  `id` INT(11) NOT NULL AUTO_INCREMENT PRIMARY KEY,
  `product_key` VARCHAR(50) NOT NULL COMMENT '产品密钥',
  `product_name` VARCHAR(100) NOT NULL COMMENT '产品名称',
  `product_type` VARCHAR(50) DEFAULT NULL COMMENT '产品类型',
  
  -- 产品配置
  `feature_definition` LONGTEXT DEFAULT NULL COMMENT '功能定义（JSON）',
  `control_panel_config` LONGTEXT DEFAULT NULL COMMENT '控制面板配置（JSON）',
  
  -- 状态
  `is_active` TINYINT(1) DEFAULT 1 COMMENT '是否启用',
  
  -- 时间戳
  `created_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `updated_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  
  UNIQUE KEY `uk_product_key` (`product_key`),
  KEY `idx_product_type` (`product_type`)
  
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci 
COMMENT='设备产品表';
```

## 知识库模块

### 知识库表 (kb_knowledge_bases)

```sql
CREATE TABLE `kb_knowledge_bases` (
  `id` INT(11) NOT NULL AUTO_INCREMENT PRIMARY KEY,
  `uuid` CHAR(36) NOT NULL COMMENT 'UUID',
  
  -- 基本信息
  `name` VARCHAR(100) NOT NULL COMMENT '知识库名称',
  `description` TEXT DEFAULT NULL COMMENT '描述',
  `category` VARCHAR(50) DEFAULT NULL COMMENT '分类',
  
  -- 所有权
  `owner_id` INT(11) NOT NULL COMMENT '创建者ID',
  `owner_type` ENUM('user', 'school', 'system') DEFAULT 'user' COMMENT '所有者类型',
  
  -- 可见性
  `visibility` ENUM('private', 'school', 'public') DEFAULT 'private' 
    COMMENT '可见性：private-私有, school-学校, public-公开',
  
  -- 向量化配置
  `embedding_model` VARCHAR(50) DEFAULT 'text-embedding-ada-002' COMMENT '向量模型',
  `chunk_size` INT DEFAULT 500 COMMENT '分块大小',
  `chunk_overlap` INT DEFAULT 50 COMMENT '分块重叠',
  
  -- 统计信息
  `document_count` INT DEFAULT 0 COMMENT '文档数量',
  `total_chunks` INT DEFAULT 0 COMMENT '总分块数',
  
  -- 状态
  `is_active` TINYINT(1) DEFAULT 1 COMMENT '是否启用',
  
  -- 时间戳
  `created_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `updated_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  
  UNIQUE KEY `uk_uuid` (`uuid`),
  KEY `idx_owner_id` (`owner_id`),
  KEY `idx_visibility` (`visibility`),
  KEY `idx_category` (`category`),
  
  FOREIGN KEY (`owner_id`) REFERENCES `core_users`(`id`) 
    ON DELETE CASCADE
  
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci 
COMMENT='知识库表';
```

### 文档表 (kb_documents)

```sql
CREATE TABLE `kb_documents` (
  `id` INT(11) NOT NULL AUTO_INCREMENT PRIMARY KEY,
  `uuid` CHAR(36) NOT NULL COMMENT 'UUID',
  
  -- 关联关系
  `kb_id` INT(11) NOT NULL COMMENT '知识库ID',
  `uploader_id` INT(11) NOT NULL COMMENT '上传者ID',
  
  -- 文档信息
  `title` VARCHAR(255) NOT NULL COMMENT '文档标题',
  `file_name` VARCHAR(255) DEFAULT NULL COMMENT '文件名',
  `file_type` VARCHAR(50) DEFAULT NULL COMMENT '文件类型',
  `file_size` BIGINT DEFAULT NULL COMMENT '文件大小（字节）',
  `file_path` VARCHAR(500) DEFAULT NULL COMMENT '文件路径',
  
  -- 内容
  `content` LONGTEXT DEFAULT NULL COMMENT '文档内容（纯文本）',
  `summary` TEXT DEFAULT NULL COMMENT '文档摘要',
  
  -- 向量化状态
  `embedding_status` ENUM('pending', 'processing', 'completed', 'failed') 
    DEFAULT 'pending' COMMENT '向量化状态',
  `chunk_count` INT DEFAULT 0 COMMENT '分块数量',
  `embedding_progress` INT DEFAULT 0 COMMENT '向量化进度（%）',
  
  -- 元数据
  `metadata` JSON DEFAULT NULL COMMENT '元数据（JSON）',
  
  -- 时间戳
  `created_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `updated_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  
  UNIQUE KEY `uk_uuid` (`uuid`),
  KEY `idx_kb_id` (`kb_id`),
  KEY `idx_uploader_id` (`uploader_id`),
  KEY `idx_embedding_status` (`embedding_status`),
  
  FOREIGN KEY (`kb_id`) REFERENCES `kb_knowledge_bases`(`id`) 
    ON DELETE CASCADE,
  FOREIGN KEY (`uploader_id`) REFERENCES `core_users`(`id`) 
    ON DELETE CASCADE
  
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci 
COMMENT='文档表';
```

### 文档分块表 (kb_document_chunks)

```sql
CREATE TABLE `kb_document_chunks` (
  `id` INT(11) NOT NULL AUTO_INCREMENT PRIMARY KEY,
  
  -- 关联关系
  `document_id` INT(11) NOT NULL COMMENT '文档ID',
  `kb_id` INT(11) NOT NULL COMMENT '知识库ID',
  
  -- 分块信息
  `chunk_index` INT NOT NULL COMMENT '分块索引',
  `content` TEXT NOT NULL COMMENT '分块内容',
  `token_count` INT DEFAULT 0 COMMENT 'Token 数量',
  
  -- 向量
  `embedding` LONGTEXT DEFAULT NULL COMMENT '向量（JSON数组）',
  
  -- 元数据
  `metadata` JSON DEFAULT NULL COMMENT '元数据',
  
  -- 时间戳
  `created_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  
  KEY `idx_document_id` (`document_id`),
  KEY `idx_kb_id` (`kb_id`),
  
  FOREIGN KEY (`document_id`) REFERENCES `kb_documents`(`id`) 
    ON DELETE CASCADE,
  FOREIGN KEY (`kb_id`) REFERENCES `kb_knowledge_bases`(`id`) 
    ON DELETE CASCADE
  
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci 
COMMENT='文档分块表';
```

## 关系设计

### ER 图示例

```
用户 (core_users)
  │
  ├─1:N─→ 设备 (device_main)
  ├─1:N─→ 知识库 (kb_knowledge_bases)
  ├─N:1─→ 学校 (core_schools)
  └─1:N─→ 文档 (kb_documents)

学校 (core_schools)
  │
  ├─1:N─→ 用户 (core_users)
  └─1:N─→ 设备 (device_main)

知识库 (kb_knowledge_bases)
  │
  ├─1:N─→ 文档 (kb_documents)
  └─N:1─→ 用户 (core_users)

文档 (kb_documents)
  │
  ├─1:N─→ 分块 (kb_document_chunks)
  └─N:1─→ 知识库 (kb_knowledge_bases)

设备 (device_main)
  │
  ├─N:1─→ 用户 (core_users)
  ├─N:1─→ 学校 (core_schools)
  └─N:1─→ 产品 (device_products)
```

## 索引设计

### 索引类型

1. **主键索引 (PRIMARY KEY)**
```sql
PRIMARY KEY (`id`)
```

2. **唯一索引 (UNIQUE)**
```sql
UNIQUE KEY `uk_email` (`email`)
UNIQUE KEY `uk_uuid` (`uuid`)
```

3. **普通索引 (INDEX)**
```sql
KEY `idx_user_id` (`user_id`)
KEY `idx_created_at` (`created_at`)
```

4. **复合索引**
```sql
KEY `idx_school_role` (`school_id`, `role`)
KEY `idx_kb_status` (`kb_id`, `embedding_status`)
```

### 索引设计原则

```sql
-- ✅ 经常查询的字段
KEY `idx_email` (`email`)

-- ✅ 外键字段
KEY `idx_user_id` (`user_id`)

-- ✅ 排序字段
KEY `idx_created_at` (`created_at`)

-- ✅ WHERE 条件字段
KEY `idx_status` (`status`)

-- ✅ JOIN 连接字段
KEY `idx_school_id` (`school_id`)

-- ❌ 避免在低选择性字段建索引
-- 如: gender (只有3个值)

-- ❌ 避免在频繁更新的字段建索引
-- 如: last_seen (每次心跳都更新)
```

## 外键约束

### 级联操作

```sql
-- CASCADE: 级联删除/更新
FOREIGN KEY (`user_id`) REFERENCES `core_users`(`id`) 
  ON DELETE CASCADE
  ON UPDATE CASCADE

-- SET NULL: 设置为 NULL
FOREIGN KEY (`school_id`) REFERENCES `core_schools`(`id`) 
  ON DELETE SET NULL

-- RESTRICT: 限制删除（默认）
FOREIGN KEY (`product_id`) REFERENCES `device_products`(`id`) 
  ON DELETE RESTRICT

-- NO ACTION: 不执行任何操作
FOREIGN KEY (`kb_id`) REFERENCES `kb_knowledge_bases`(`id`) 
  ON DELETE NO ACTION
```

### 使用场景

| 场景 | 策略 | 示例 |
|------|------|------|
| **主从关系** | CASCADE | 删除知识库 → 删除所有文档 |
| **可选关联** | SET NULL | 删除学校 → 设备的 school_id 置空 |
| **关键关联** | RESTRICT | 删除产品前必须先删除关联设备 |

## 性能优化

### 1. 分区表

```sql
-- 按时间分区
CREATE TABLE `interaction_logs` (
  `id` INT NOT NULL,
  `created_at` DATETIME NOT NULL,
  ...
) 
PARTITION BY RANGE (YEAR(created_at)) (
  PARTITION p2023 VALUES LESS THAN (2024),
  PARTITION p2024 VALUES LESS THAN (2025),
  PARTITION p2025 VALUES LESS THAN (2026),
  PARTITION p_future VALUES LESS THAN MAXVALUE
);
```

### 2. 冗余字段

```sql
-- 减少 JOIN 查询
CREATE TABLE `device_main` (
  ...
  `user_name` VARCHAR(100) COMMENT '用户名（冗余）',
  `school_name` VARCHAR(200) COMMENT '学校名（冗余）',
  ...
);
```

### 3. 查询优化

```sql
-- ✅ 使用覆盖索引
SELECT id, name FROM core_users WHERE email = 'test@example.com';
CREATE INDEX idx_email_name ON core_users(email, name);

-- ✅ 避免 SELECT *
SELECT id, name, email FROM core_users;

-- ✅ 使用 LIMIT
SELECT * FROM devices ORDER BY created_at DESC LIMIT 20;

-- ✅ 使用 EXPLAIN 分析
EXPLAIN SELECT * FROM devices WHERE user_id = 1;
```

## 数据迁移

### 添加字段（兼容 MySQL 5.7）

```sql
-- 方法1: 使用存储过程检查字段是否存在
SET @column_exists = (
  SELECT COUNT(*) FROM information_schema.COLUMNS 
  WHERE TABLE_SCHEMA = DATABASE() 
  AND TABLE_NAME = 'core_users' 
  AND COLUMN_NAME = 'avatar'
);

SET @sql = IF(@column_exists = 0,
  'ALTER TABLE `core_users` ADD COLUMN `avatar` VARCHAR(255) DEFAULT NULL COMMENT \'头像\' AFTER `real_name`',
  'SELECT "Column already exists" AS notice'
);

PREPARE stmt FROM @sql;
EXECUTE stmt;
DEALLOCATE PREPARE stmt;

-- 方法2: 使用 CREATE TABLE IF NOT EXISTS
CREATE TABLE IF NOT EXISTS `new_table` (
  `id` INT PRIMARY KEY AUTO_INCREMENT,
  ...
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;
```

## 教学要点总结

### 核心概念
1. **表设计**: 范式、字段类型、约束
2. **关系设计**: 一对一、一对多、多对多
3. **索引优化**: 主键、唯一、普通、复合索引
4. **外键约束**: CASCADE、SET NULL、RESTRICT
5. **性能优化**: 分区、冗余、查询优化

### 设计原则
- ✅ 符合三范式（适当反范式）
- ✅ 合理使用索引
- ✅ 统一命名规范
- ✅ 完整的时间戳
- ✅ 软删除支持

### 适合讲授
- 数据库设计
- SQL 基础
- 索引优化
- 查询优化
- 数据迁移

## 相关文档

- [SQLAlchemy-ORM](../05_核心技术/SQLAlchemy-ORM.md) - ORM 操作
- [后端架构](./后端架构.md) - 后端设计
- [常见问题排查](../04_开发调试/常见问题排查.md) - 数据库问题
