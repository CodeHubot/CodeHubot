# é”™è¯¯å¤„ç†è§„èŒƒ

> æœ¬æ–‡æ¡£å®šä¹‰äº† CodeHubot é¡¹ç›®çš„é”™è¯¯å¤„ç†è§„èŒƒï¼ŒåŒ…æ‹¬åç«¯å¼‚å¸¸å¤„ç†å’Œå‰ç«¯é”™è¯¯æç¤ºã€‚

## ğŸ“‹ ç›®å½•

- [åç«¯é”™è¯¯å¤„ç†](#åç«¯é”™è¯¯å¤„ç†)
- [å‰ç«¯é”™è¯¯å¤„ç†](#å‰ç«¯é”™è¯¯å¤„ç†)
- [é”™è¯¯ç å®šä¹‰](#é”™è¯¯ç å®šä¹‰)
- [é”™è¯¯æ—¥å¿—è®°å½•](#é”™è¯¯æ—¥å¿—è®°å½•)
- [æœ€ä½³å®è·µ](#æœ€ä½³å®è·µ)

---

## ğŸ”§ åç«¯é”™è¯¯å¤„ç†

### 1. ç»Ÿä¸€å¼‚å¸¸å¤„ç†

```python
from fastapi import HTTPException, Request
from fastapi.responses import JSONResponse
from sqlalchemy.exc import IntegrityError
import logging

logger = logging.getLogger(__name__)

# âœ… åœ¨ main.py ä¸­æ³¨å†Œå…¨å±€å¼‚å¸¸å¤„ç†å™¨
from fastapi import FastAPI

app = FastAPI()

@app.exception_handler(HTTPException)
async def http_exception_handler(request: Request, exc: HTTPException):
    """å¤„ç† HTTP å¼‚å¸¸"""
    return JSONResponse(
        status_code=exc.status_code,
        content={
            "code": exc.status_code,
            "message": exc.detail,
            "data": None
        }
    )

@app.exception_handler(Exception)
async def general_exception_handler(request: Request, exc: Exception):
    """å¤„ç†æ‰€æœ‰æœªæ•è·çš„å¼‚å¸¸"""
    logger.error(f"æœªå¤„ç†çš„å¼‚å¸¸: {str(exc)}", exc_info=True)
    return JSONResponse(
        status_code=500,
        content={
            "code": 500,
            "message": "æœåŠ¡å™¨å†…éƒ¨é”™è¯¯",
            "data": None
        }
    )
```

### 2. ä½¿ç”¨ HTTPException

```python
from fastapi import HTTPException, Depends
from sqlalchemy.orm import Session

@router.get("/courses/{course_uuid}")
def get_course(
    course_uuid: str,
    db: Session = Depends(get_db)
):
    """è·å–è¯¾ç¨‹è¯¦æƒ…"""
    
    # æŸ¥è¯¢è¯¾ç¨‹
    course = db.query(Course).filter(Course.uuid == course_uuid).first()
    
    # âœ… èµ„æºä¸å­˜åœ¨ - 404
    if not course:
        raise HTTPException(
            status_code=404,
            detail="è¯¾ç¨‹ä¸å­˜åœ¨"
        )
    
    # âœ… è½¯åˆ é™¤æ£€æŸ¥
    if course.is_deleted:
        raise HTTPException(
            status_code=404,
            detail="è¯¾ç¨‹å·²è¢«åˆ é™¤"
        )
    
    return success_response(data=course.to_dict())

@router.post("/courses")
def create_course(
    course: CourseCreate,
    current_user = Depends(get_current_user),
    db: Session = Depends(get_db)
):
    """åˆ›å»ºè¯¾ç¨‹"""
    
    # âœ… æƒé™æ£€æŸ¥ - 403
    if current_user.role not in ['admin', 'teacher']:
        raise HTTPException(
            status_code=403,
            detail="æ— æƒåˆ›å»ºè¯¾ç¨‹"
        )
    
    # âœ… å‚æ•°éªŒè¯ - 400
    if len(course.title) < 2:
        raise HTTPException(
            status_code=400,
            detail="è¯¾ç¨‹æ ‡é¢˜è‡³å°‘2ä¸ªå­—ç¬¦"
        )
    
    # åˆ›å»ºè¯¾ç¨‹
    try:
        new_course = Course(**course.dict())
        db.add(new_course)
        db.commit()
        return success_response(data=new_course.to_dict())
    except Exception as e:
        db.rollback()
        logger.error(f"åˆ›å»ºè¯¾ç¨‹å¤±è´¥: {str(e)}")
        raise HTTPException(status_code=500, detail="åˆ›å»ºå¤±è´¥")
```

### 3. æ•°æ®åº“å¼‚å¸¸å¤„ç†

```python
from sqlalchemy.exc import IntegrityError, SQLAlchemyError

@router.post("/courses")
def create_course(course: CourseCreate, db: Session = Depends(get_db)):
    try:
        new_course = Course(**course.dict())
        db.add(new_course)
        db.commit()
        db.refresh(new_course)
        
        return success_response(data=new_course.to_dict())
        
    except IntegrityError as e:
        # âœ… æ•°æ®åº“çº¦æŸé”™è¯¯(å”¯ä¸€é”®ã€å¤–é”®ç­‰)
        db.rollback()
        logger.warning(f"æ•°æ®åº“çº¦æŸé”™è¯¯: {str(e)}")
        
        # åˆ¤æ–­å…·ä½“é”™è¯¯ç±»å‹
        error_msg = str(e.orig)
        if "Duplicate entry" in error_msg:
            raise HTTPException(status_code=400, detail="è¯¾ç¨‹åç§°å·²å­˜åœ¨")
        elif "foreign key constraint" in error_msg:
            raise HTTPException(status_code=400, detail="å…³è”æ•°æ®ä¸å­˜åœ¨")
        else:
            raise HTTPException(status_code=400, detail="æ•°æ®çº¦æŸé”™è¯¯")
            
    except SQLAlchemyError as e:
        # âœ… å…¶ä»–æ•°æ®åº“é”™è¯¯
        db.rollback()
        logger.error(f"æ•°æ®åº“é”™è¯¯: {str(e)}", exc_info=True)
        raise HTTPException(status_code=500, detail="æ•°æ®åº“æ“ä½œå¤±è´¥")
        
    except Exception as e:
        # âœ… å…¶ä»–æœªçŸ¥é”™è¯¯
        db.rollback()
        logger.error(f"æœªçŸ¥é”™è¯¯: {str(e)}", exc_info=True)
        raise HTTPException(status_code=500, detail="æ“ä½œå¤±è´¥")
```

### 4. ä¸šåŠ¡é”™è¯¯å¤„ç†

```python
from app.core.response import error_response

@router.post("/courses/{course_uuid}/publish")
def publish_course(
    course_uuid: str,
    db: Session = Depends(get_db)
):
    """å‘å¸ƒè¯¾ç¨‹"""
    
    course = db.query(Course).filter(Course.uuid == course_uuid).first()
    
    if not course:
        raise HTTPException(status_code=404, detail="è¯¾ç¨‹ä¸å­˜åœ¨")
    
    # âœ… ä¸šåŠ¡é€»è¾‘éªŒè¯
    if course.status == "published":
        # ä½¿ç”¨ä¸šåŠ¡é”™è¯¯ç (ä¸æ˜¯ HTTP é”™è¯¯)
        return error_response(
            code=4001,
            message="è¯¾ç¨‹å·²å‘å¸ƒï¼Œæ— éœ€é‡å¤æ“ä½œ",
            status_code=400
        )
    
    if not course.units or len(course.units) == 0:
        return error_response(
            code=4002,
            message="è¯¾ç¨‹è‡³å°‘éœ€è¦ä¸€ä¸ªå•å…ƒæ‰èƒ½å‘å¸ƒ",
            status_code=400
        )
    
    # å‘å¸ƒè¯¾ç¨‹
    course.status = "published"
    course.published_at = datetime.now()
    db.commit()
    
    return success_response(message="å‘å¸ƒæˆåŠŸ")
```

### 5. å‚æ•°éªŒè¯é”™è¯¯

```python
from pydantic import BaseModel, Field, validator
from fastapi import HTTPException

class CourseCreate(BaseModel):
    title: str = Field(..., min_length=2, max_length=200)
    description: str = Field(None, max_length=2000)
    status: str = "draft"
    
    @validator('status')
    def validate_status(cls, v):
        """âœ… è‡ªå®šä¹‰éªŒè¯å™¨"""
        allowed = ['draft', 'published', 'archived']
        if v not in allowed:
            raise ValueError(f'çŠ¶æ€å¿…é¡»æ˜¯: {", ".join(allowed)}')
        return v
    
    @validator('title')
    def validate_title(cls, v):
        """âœ… éªŒè¯æ ‡é¢˜"""
        if not v or v.strip() == "":
            raise ValueError('æ ‡é¢˜ä¸èƒ½ä¸ºç©º')
        if len(v.strip()) < 2:
            raise ValueError('æ ‡é¢˜è‡³å°‘2ä¸ªå­—ç¬¦')
        return v.strip()

# FastAPI ä¼šè‡ªåŠ¨æ•è· Pydantic éªŒè¯é”™è¯¯å¹¶è¿”å› 422
```

---

## ğŸŒ å‰ç«¯é”™è¯¯å¤„ç†

### 1. ç»Ÿä¸€è¯·æ±‚æ‹¦æˆªå™¨

```javascript
// utils/request.js
import axios from 'axios'
import { ElMessage } from 'element-plus'
import router from '@/router'

const service = axios.create({
  baseURL: '/api',
  timeout: 30000
})

// å“åº”æ‹¦æˆªå™¨
service.interceptors.response.use(
  response => {
    // âœ… æˆåŠŸå“åº” (HTTP 200)
    const { code, message, data } = response.data
    
    if (code === 200) {
      return data  // ç›´æ¥è¿”å› data
    } else {
      // ä¸šåŠ¡é”™è¯¯
      ElMessage.error(message || 'æ“ä½œå¤±è´¥')
      return Promise.reject(new Error(message))
    }
  },
  error => {
    // âœ… HTTP é”™è¯¯å¤„ç†
    if (error.response) {
      const { status, data } = error.response
      
      switch (status) {
        case 400:
          ElMessage.error(data.message || 'è¯·æ±‚å‚æ•°é”™è¯¯')
          break
          
        case 401:
          // æœªç™»å½•æˆ– token è¿‡æœŸ
          ElMessage.error('ç™»å½•å·²è¿‡æœŸï¼Œè¯·é‡æ–°ç™»å½•')
          localStorage.removeItem('token')
          router.push('/login')
          break
          
        case 403:
          ElMessage.error(data.message || 'æ— æƒè®¿é—®')
          break
          
        case 404:
          ElMessage.error(data.message || 'èµ„æºä¸å­˜åœ¨')
          break
          
        case 500:
          ElMessage.error(data.message || 'æœåŠ¡å™¨é”™è¯¯')
          break
          
        default:
          ElMessage.error(data.message || 'æœªçŸ¥é”™è¯¯')
      }
    } else if (error.request) {
      // âœ… ç½‘ç»œé”™è¯¯(æ— å“åº”)
      ElMessage.error('ç½‘ç»œè¿æ¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œ')
    } else {
      // âœ… è¯·æ±‚é…ç½®é”™è¯¯
      ElMessage.error('è¯·æ±‚å¤±è´¥: ' + error.message)
    }
    
    return Promise.reject(error)
  }
)

export default service
```

### 2. ç»„ä»¶ä¸­çš„é”™è¯¯å¤„ç†

```vue
<script setup>
import { ref } from 'vue'
import { ElMessage, ElMessageBox } from 'element-plus'
import { getAgents, deleteAgent } from '@/modules/ai/api/agents'

const loading = ref(false)
const courses = ref([])

// âœ… åŠ è½½æ•°æ® - åŸºç¡€é”™è¯¯å¤„ç†
async function loadCourses() {
  try {
    loading.value = true
    const data = await getCourses({ page: 1, pageSize: 20 })
    courses.value = data.items
  } catch (error) {
    // é”™è¯¯å·²åœ¨ request ä¸­ç»Ÿä¸€å¤„ç†ï¼Œè¿™é‡Œå¯ä»¥è®°å½•æ—¥å¿—
    console.error('åŠ è½½è¯¾ç¨‹å¤±è´¥:', error)
    // å¯é€‰ï¼šæ˜¾ç¤ºé¢å¤–æç¤º
    // ElMessage.error('åŠ è½½è¯¾ç¨‹å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•')
  } finally {
    loading.value = false
  }
}

// âœ… åˆ é™¤æ“ä½œ - å¸¦ç¡®è®¤çš„é”™è¯¯å¤„ç†
async function handleDelete(courseId) {
  try {
    // ç¡®è®¤å¯¹è¯æ¡†
    await ElMessageBox.confirm(
      'ç¡®å®šè¦åˆ é™¤è¿™ä¸ªè¯¾ç¨‹å—ï¼Ÿ',
      'è­¦å‘Š',
      { type: 'warning' }
    )
    
    // æ‰§è¡Œåˆ é™¤
    await deleteCourse(courseId)
    ElMessage.success('åˆ é™¤æˆåŠŸ')
    
    // åˆ·æ–°åˆ—è¡¨
    loadCourses()
    
  } catch (error) {
    if (error === 'cancel') {
      // ç”¨æˆ·å–æ¶ˆæ“ä½œ
      return
    }
    console.error('åˆ é™¤å¤±è´¥:', error)
  }
}

// âœ… è¡¨å•æäº¤ - å®Œæ•´é”™è¯¯å¤„ç†
async function handleSubmit() {
  try {
    // 1. è¡¨å•éªŒè¯
    await formRef.value.validate()
    
    // 2. æäº¤æ•°æ®
    loading.value = true
    await createCourse(formData.value)
    
    // 3. æˆåŠŸæç¤º
    ElMessage.success('åˆ›å»ºæˆåŠŸ')
    
    // 4. åç»­æ“ä½œ
    dialogVisible.value = false
    loadCourses()
    
  } catch (error) {
    if (error.errors) {
      // è¡¨å•éªŒè¯å¤±è´¥
      ElMessage.warning('è¯·æ£€æŸ¥è¡¨å•å¡«å†™')
    } else {
      // API è°ƒç”¨å¤±è´¥ï¼ˆå·²åœ¨ request ä¸­æç¤ºï¼‰
      console.error('æäº¤å¤±è´¥:', error)
    }
  } finally {
    loading.value = false
  }
}
</script>
```

### 3. å…¨å±€é”™è¯¯å¤„ç†

```javascript
// main.js
import { createApp } from 'vue'
import App from './App.vue'

const app = createApp(App)

// âœ… å…¨å±€é”™è¯¯å¤„ç†å™¨
app.config.errorHandler = (err, instance, info) => {
  console.error('å…¨å±€é”™è¯¯:', err)
  console.error('é”™è¯¯ä¿¡æ¯:', info)
  
  // å¯ä»¥ä¸ŠæŠ¥åˆ°é”™è¯¯ç›‘æ§å¹³å°
  // reportError(err, info)
}

app.mount('#app')
```

---

## ğŸ”¢ é”™è¯¯ç å®šä¹‰

### 1. HTTP çŠ¶æ€ç 

| çŠ¶æ€ç  | å«ä¹‰ | ä½¿ç”¨åœºæ™¯ |
|--------|------|----------|
| 200 | æˆåŠŸ | è¯·æ±‚æˆåŠŸ |
| 201 | åˆ›å»ºæˆåŠŸ | èµ„æºåˆ›å»ºæˆåŠŸ |
| 204 | æ— å†…å®¹ | åˆ é™¤æˆåŠŸ(æ— è¿”å›æ•°æ®) |
| 400 | å‚æ•°é”™è¯¯ | è¯·æ±‚å‚æ•°éªŒè¯å¤±è´¥ |
| 401 | æœªè®¤è¯ | æœªç™»å½•æˆ– token è¿‡æœŸ |
| 403 | æ— æƒé™ | æ²¡æœ‰æƒé™è®¿é—®èµ„æº |
| 404 | ä¸å­˜åœ¨ | èµ„æºä¸å­˜åœ¨ |
| 409 | å†²çª | èµ„æºçŠ¶æ€å†²çª |
| 422 | éªŒè¯å¤±è´¥ | Pydantic å‚æ•°éªŒè¯å¤±è´¥ |
| 500 | æœåŠ¡å™¨é”™è¯¯ | æœåŠ¡å™¨å†…éƒ¨é”™è¯¯ |
| 502 | ç½‘å…³é”™è¯¯ | ä¸Šæ¸¸æœåŠ¡é”™è¯¯ |
| 503 | æœåŠ¡ä¸å¯ç”¨ | æœåŠ¡ç»´æŠ¤ä¸­ |

### 2. ä¸šåŠ¡é”™è¯¯ç 

```python
# ä¸šåŠ¡é”™è¯¯ç å®šä¹‰
# æ ¼å¼: æ¨¡å—(2ä½) + é”™è¯¯ç±»å‹(2ä½)

# é€šç”¨é”™è¯¯ (10xx)
10001 = "æ“ä½œå¤±è´¥"
10002 = "å‚æ•°é”™è¯¯"
10003 = "æ•°æ®ä¸å­˜åœ¨"

# ç”¨æˆ·æ¨¡å— (20xx)
20001 = "ç”¨æˆ·åå·²å­˜åœ¨"
20002 = "é‚®ç®±å·²è¢«æ³¨å†Œ"
20003 = "å¯†ç é”™è¯¯"
20004 = "ç”¨æˆ·ä¸å­˜åœ¨"
20005 = "è´¦å·å·²è¢«ç¦ç”¨"

# è¯¾ç¨‹æ¨¡å— (30xx)
30001 = "è¯¾ç¨‹åç§°å·²å­˜åœ¨"
30002 = "è¯¾ç¨‹ä¸å­˜åœ¨"
30003 = "è¯¾ç¨‹å·²å‘å¸ƒï¼Œæ— æ³•ä¿®æ”¹"
30004 = "è¯¾ç¨‹è‡³å°‘éœ€è¦ä¸€ä¸ªå•å…ƒ"

# æƒé™æ¨¡å— (40xx)
40001 = "æ— æƒè®¿é—®"
40002 = "æ— æƒä¿®æ”¹"
40003 = "æ— æƒåˆ é™¤"

# ä½¿ç”¨ç¤ºä¾‹
from app.core.response import error_response

return error_response(
    code=30001,
    message="è¯¾ç¨‹åç§°å·²å­˜åœ¨",
    status_code=400
)
```

---

## ğŸ“ é”™è¯¯æ—¥å¿—è®°å½•

### 1. æ—¥å¿—é…ç½®

```python
# app/core/logging_config.py
import logging
from logging.handlers import RotatingFileHandler
import os

def setup_logging():
    """é…ç½®æ—¥å¿—"""
    
    # åˆ›å»ºæ—¥å¿—ç›®å½•
    log_dir = "logs"
    os.makedirs(log_dir, exist_ok=True)
    
    # æ—¥å¿—æ ¼å¼
    formatter = logging.Formatter(
        '%(asctime)s - %(name)s - %(levelname)s - %(message)s'
    )
    
    # æ–‡ä»¶å¤„ç†å™¨(è‡ªåŠ¨è½®è½¬)
    file_handler = RotatingFileHandler(
        f"{log_dir}/app.log",
        maxBytes=10*1024*1024,  # 10MB
        backupCount=10
    )
    file_handler.setFormatter(formatter)
    file_handler.setLevel(logging.INFO)
    
    # é”™è¯¯æ—¥å¿—å•ç‹¬æ–‡ä»¶
    error_handler = RotatingFileHandler(
        f"{log_dir}/error.log",
        maxBytes=10*1024*1024,
        backupCount=10
    )
    error_handler.setFormatter(formatter)
    error_handler.setLevel(logging.ERROR)
    
    # æ§åˆ¶å°å¤„ç†å™¨
    console_handler = logging.StreamHandler()
    console_handler.setFormatter(formatter)
    console_handler.setLevel(logging.DEBUG)
    
    # é…ç½®æ ¹æ—¥å¿—è®°å½•å™¨
    root_logger = logging.getLogger()
    root_logger.setLevel(logging.INFO)
    root_logger.addHandler(file_handler)
    root_logger.addHandler(error_handler)
    root_logger.addHandler(console_handler)
```

### 2. æ—¥å¿—è®°å½•è§„èŒƒ

```python
import logging

logger = logging.getLogger(__name__)

@router.post("/courses")
def create_course(course: CourseCreate, db: Session = Depends(get_db)):
    try:
        # âœ… è®°å½•å…³é”®æ“ä½œ
        logger.info(f"åˆ›å»ºè¯¾ç¨‹: {course.title}")
        
        new_course = Course(**course.dict())
        db.add(new_course)
        db.commit()
        
        # âœ… è®°å½•æˆåŠŸæ“ä½œ
        logger.info(f"è¯¾ç¨‹åˆ›å»ºæˆåŠŸ: id={new_course.id}, uuid={new_course.uuid}")
        
        return success_response(data=new_course.to_dict())
        
    except IntegrityError as e:
        db.rollback()
        # âœ… è®°å½•è­¦å‘Š(é¢„æœŸå†…çš„é”™è¯¯)
        logger.warning(f"è¯¾ç¨‹åç§°é‡å¤: {course.title}, error: {str(e)}")
        raise HTTPException(status_code=400, detail="è¯¾ç¨‹åç§°å·²å­˜åœ¨")
        
    except Exception as e:
        db.rollback()
        # âœ… è®°å½•é”™è¯¯(åŒ…å«å †æ ˆä¿¡æ¯)
        logger.error(
            f"åˆ›å»ºè¯¾ç¨‹å¤±è´¥: {course.title}",
            exc_info=True  # åŒ…å«å®Œæ•´å †æ ˆ
        )
        raise HTTPException(status_code=500, detail="åˆ›å»ºå¤±è´¥")

# æ—¥å¿—çº§åˆ«ä½¿ç”¨:
# logger.debug()    - è°ƒè¯•ä¿¡æ¯
# logger.info()     - ä¸€èˆ¬ä¿¡æ¯
# logger.warning()  - è­¦å‘Š(é¢„æœŸå†…çš„é—®é¢˜)
# logger.error()    - é”™è¯¯(éœ€è¦å…³æ³¨çš„é—®é¢˜)
# logger.critical() - ä¸¥é‡é”™è¯¯(ç³»ç»Ÿæ— æ³•è¿è¡Œ)
```

### 3. æ•æ„Ÿä¿¡æ¯è¿‡æ»¤

```python
import logging

logger = logging.getLogger(__name__)

def safe_log_data(data: dict) -> dict:
    """è¿‡æ»¤æ•æ„Ÿä¿¡æ¯"""
    sensitive_fields = ['password', 'token', 'secret', 'api_key']
    safe_data = data.copy()
    
    for field in sensitive_fields:
        if field in safe_data:
            safe_data[field] = '***'
    
    return safe_data

# âœ… ä½¿ç”¨
logger.info(f"ç”¨æˆ·ç™»å½•: {safe_log_data(user_data)}")

# âŒ é¿å…è®°å½•æ•æ„Ÿä¿¡æ¯
logger.info(f"ç”¨æˆ·ç™»å½•: {user_data}")  # å¯èƒ½åŒ…å«å¯†ç 
```

---

## ğŸ’¡ æœ€ä½³å®è·µ

### 1. é”™è¯¯ä¿¡æ¯è®¾è®¡

```python
# âœ… å¥½çš„é”™è¯¯ä¿¡æ¯:
# - æ¸…æ™°æè¿°é—®é¢˜
# - æä¾›è§£å†³å»ºè®®
# - ä¸æš´éœ²æ•æ„Ÿä¿¡æ¯

raise HTTPException(
    status_code=400,
    detail="è¯¾ç¨‹æ ‡é¢˜å·²å­˜åœ¨ï¼Œè¯·ä½¿ç”¨å…¶ä»–æ ‡é¢˜"
)

raise HTTPException(
    status_code=403,
    detail="åªæœ‰æ•™å¸ˆå¯ä»¥åˆ›å»ºè¯¾ç¨‹"
)

# âŒ ä¸å¥½çš„é”™è¯¯ä¿¡æ¯:
raise HTTPException(status_code=500, detail="Error")  # ä¸æ¸…æ™°
raise HTTPException(status_code=400, detail=str(e))   # å¯èƒ½æš´éœ²æŠ€æœ¯ç»†èŠ‚
```

### 2. é”™è¯¯åˆ†ç±»å¤„ç†

```python
@router.post("/courses")
def create_course(course: CourseCreate, db: Session = Depends(get_db)):
    try:
        # ä¸šåŠ¡é€»è¾‘
        pass
        
    except HTTPException:
        # âœ… HTTPException ç›´æ¥æŠ›å‡ºï¼Œä¸éœ€è¦é¢å¤–å¤„ç†
        raise
        
    except IntegrityError as e:
        # âœ… æ•°æ®åº“çº¦æŸé”™è¯¯ - è½¬æ¢ä¸ºå‹å¥½æç¤º
        db.rollback()
        raise HTTPException(status_code=400, detail="æ•°æ®å·²å­˜åœ¨")
        
    except ValueError as e:
        # âœ… å‚æ•°å€¼é”™è¯¯ - è¿”å› 400
        raise HTTPException(status_code=400, detail=str(e))
        
    except Exception as e:
        # âœ… æœªçŸ¥é”™è¯¯ - è®°å½•æ—¥å¿—å¹¶è¿”å›é€šç”¨é”™è¯¯
        db.rollback()
        logger.error(f"åˆ›å»ºè¯¾ç¨‹å¤±è´¥: {str(e)}", exc_info=True)
        raise HTTPException(status_code=500, detail="åˆ›å»ºå¤±è´¥")
```

### 3. ä¼˜é›…é™çº§

```javascript
// âœ… å‰ç«¯ä¼˜é›…é™çº§
async function loadCourses() {
  try {
    const data = await getCourses()
    courses.value = data.items
  } catch (error) {
    // åŠ è½½å¤±è´¥ï¼Œæ˜¾ç¤ºç©ºçŠ¶æ€
    courses.value = []
    // ä¸é˜»æ–­ç”¨æˆ·æ“ä½œ
  }
}

// âœ… æä¾›é»˜è®¤å€¼
const courseDetail = ref({
  title: 'åŠ è½½ä¸­...',
  description: '',
  units: []
})
```

### 4. é”™è¯¯ç›‘æ§

```python
# é›†æˆé”™è¯¯ç›‘æ§æœåŠ¡(å¦‚ Sentry)
import sentry_sdk

sentry_sdk.init(
    dsn="your-dsn",
    traces_sample_rate=1.0
)

# è‡ªåŠ¨æ•è·æœªå¤„ç†çš„å¼‚å¸¸
```

---

## ğŸ“š å‚è€ƒèµ„æº

- [FastAPI é”™è¯¯å¤„ç†æ–‡æ¡£](https://fastapi.tiangolo.com/tutorial/handling-errors/)
- [HTTP çŠ¶æ€ç ](https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Status)
- [Python logging æ–‡æ¡£](https://docs.python.org/zh-cn/3/library/logging.html)

---

**è®°ä½**: è‰¯å¥½çš„é”™è¯¯å¤„ç†è®©ç³»ç»Ÿæ›´å¥å£®ï¼Œç”¨æˆ·ä½“éªŒæ›´å‹å¥½ï¼
