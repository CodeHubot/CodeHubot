# å®‰å…¨è§„èŒƒ

> æœ¬æ–‡æ¡£å®šä¹‰äº† CodeHubot é¡¹ç›®çš„å®‰å…¨å¼€å‘è§„èŒƒï¼ŒåŒ…æ‹¬è®¤è¯æˆæƒã€æ•°æ®åŠ å¯†å’Œå¸¸è§å®‰å…¨é˜²æŠ¤æªæ–½ã€‚

## ğŸ“‹ ç›®å½•

- [è®¤è¯æˆæƒ](#è®¤è¯æˆæƒ)
- [æ•°æ®åŠ å¯†](#æ•°æ®åŠ å¯†)
- [è¾“å…¥éªŒè¯](#è¾“å…¥éªŒè¯)
- [SQL æ³¨å…¥é˜²æŠ¤](#sql-æ³¨å…¥é˜²æŠ¤)
- [XSS é˜²æŠ¤](#xss-é˜²æŠ¤)
- [CSRF é˜²æŠ¤](#csrf-é˜²æŠ¤)
- [API å®‰å…¨](#api-å®‰å…¨)
- [æ•æ„Ÿä¿¡æ¯ä¿æŠ¤](#æ•æ„Ÿä¿¡æ¯ä¿æŠ¤)
- [æœ€ä½³å®è·µ](#æœ€ä½³å®è·µ)

---

## ğŸ” è®¤è¯æˆæƒ

### 1. JWT Token è®¤è¯

```python
# backend/app/core/security.py
from datetime import datetime, timedelta
from jose import JWTError, jwt
from passlib.context import CryptContext

# å¯†ç åŠ å¯†ä¸Šä¸‹æ–‡
pwd_context = CryptContext(schemes=["bcrypt"], deprecated="auto")

# JWT é…ç½®
SECRET_KEY = "your-secret-key"  # ä»ç¯å¢ƒå˜é‡è¯»å–
ALGORITHM = "HS256"
ACCESS_TOKEN_EXPIRE_MINUTES = 60 * 24  # 24å°æ—¶

def create_access_token(data: dict) -> str:
    """åˆ›å»ºè®¿é—®ä»¤ç‰Œ"""
    to_encode = data.copy()
    expire = datetime.utcnow() + timedelta(minutes=ACCESS_TOKEN_EXPIRE_MINUTES)
    to_encode.update({"exp": expire})
    
    encoded_jwt = jwt.encode(to_encode, SECRET_KEY, algorithm=ALGORITHM)
    return encoded_jwt

def verify_token(token: str) -> dict:
    """éªŒè¯ä»¤ç‰Œ"""
    try:
        payload = jwt.decode(token, SECRET_KEY, algorithms=[ALGORITHM])
        return payload
    except JWTError:
        return None

def verify_password(plain_password: str, hashed_password: str) -> bool:
    """éªŒè¯å¯†ç """
    return pwd_context.verify(plain_password, hashed_password)

def get_password_hash(password: str) -> str:
    """å¯†ç åŠ å¯†"""
    return pwd_context.hash(password)
```

### 2. ä¾èµ–æ³¨å…¥è·å–å½“å‰ç”¨æˆ·

```python
# backend/app/core/deps.py
from fastapi import Depends, HTTPException, status
from fastapi.security import HTTPBearer, HTTPAuthorizationCredentials
from sqlalchemy.orm import Session

from .database import get_db
from .security import verify_token
from ..models.user import User

security = HTTPBearer()

def get_current_user(
    credentials: HTTPAuthorizationCredentials = Depends(security),
    db: Session = Depends(get_db)
) -> User:
    """è·å–å½“å‰ç™»å½•ç”¨æˆ·"""
    
    # éªŒè¯ token
    token = credentials.credentials
    payload = verify_token(token)
    
    if not payload:
        raise HTTPException(
            status_code=status.HTTP_401_UNAUTHORIZED,
            detail="tokenæ— æ•ˆæˆ–å·²è¿‡æœŸ",
            headers={"WWW-Authenticate": "Bearer"}
        )
    
    # è·å–ç”¨æˆ·ä¿¡æ¯
    user_id = payload.get("sub")
    user = db.query(User).filter(User.id == user_id).first()
    
    if not user:
        raise HTTPException(
            status_code=status.HTTP_401_UNAUTHORIZED,
            detail="ç”¨æˆ·ä¸å­˜åœ¨"
        )
    
    if not user.is_active:
        raise HTTPException(
            status_code=status.HTTP_403_FORBIDDEN,
            detail="è´¦å·å·²è¢«ç¦ç”¨"
        )
    
    return user

def get_current_admin(
    current_user: User = Depends(get_current_user)
):
    """è·å–å½“å‰ç®¡ç†å‘˜(æƒé™æ£€æŸ¥)"""
    if current_user.role not in ['admin', 'super_admin']:
        raise HTTPException(
            status_code=status.HTTP_403_FORBIDDEN,
            detail="éœ€è¦ç®¡ç†å‘˜æƒé™"
        )
    return current_user
```

### 3. å‰ç«¯ Token ç®¡ç†

```javascript
// frontend/src/utils/auth.js
/**
 * Token ç®¡ç†å·¥å…·
 */

const TOKEN_KEY = 'access_token'

/**
 * ä¿å­˜ Token
 */
export function setToken(token) {
  localStorage.setItem(TOKEN_KEY, token)
}

/**
 * è·å– Token
 */
export function getToken() {
  return localStorage.getItem(TOKEN_KEY)
}

/**
 * åˆ é™¤ Token
 */
export function removeToken() {
  localStorage.removeItem(TOKEN_KEY)
}

/**
 * æ£€æŸ¥æ˜¯å¦å·²ç™»å½•
 */
export function isAuthenticated() {
  return !!getToken()
}

/**
 * è§£æ Token(ä¸éªŒè¯ç­¾å)
 */
export function parseToken(token) {
  try {
    const base64Url = token.split('.')[1]
    const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/')
    const jsonPayload = decodeURIComponent(
      atob(base64)
        .split('')
        .map(c => '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2))
        .join('')
    )
    return JSON.parse(jsonPayload)
  } catch (error) {
    return null
  }
}

/**
 * æ£€æŸ¥ Token æ˜¯å¦è¿‡æœŸ
 */
export function isTokenExpired(token) {
  const payload = parseToken(token)
  if (!payload || !payload.exp) {
    return true
  }
  
  const currentTime = Math.floor(Date.now() / 1000)
  return payload.exp < currentTime
}
```

### 4. è¯·æ±‚æ‹¦æˆªå™¨æ·»åŠ  Token

```javascript
// frontend/src/utils/request.js
import axios from 'axios'
import { getToken, removeToken, isTokenExpired } from './auth'
import router from '@/router'

const service = axios.create({
  baseURL: '/api',
  timeout: 30000
})

// è¯·æ±‚æ‹¦æˆªå™¨
service.interceptors.request.use(
  config => {
    const token = getToken()
    
    if (token) {
      // æ£€æŸ¥ token æ˜¯å¦è¿‡æœŸ
      if (isTokenExpired(token)) {
        removeToken()
        router.push('/login')
        return Promise.reject(new Error('Tokenå·²è¿‡æœŸ'))
      }
      
      // æ·»åŠ  Authorization å¤´
      config.headers['Authorization'] = `Bearer ${token}`
    }
    
    return config
  },
  error => {
    return Promise.reject(error)
  }
)

// å“åº”æ‹¦æˆªå™¨
service.interceptors.response.use(
  response => response,
  error => {
    if (error.response && error.response.status === 401) {
      // Token æ— æ•ˆ,æ¸…é™¤å¹¶è·³è½¬ç™»å½•
      removeToken()
      router.push('/login')
    }
    return Promise.reject(error)
  }
)

export default service
```

---

## ğŸ”’ æ•°æ®åŠ å¯†

### 1. å¯†ç åŠ å¯†å­˜å‚¨

```python
# ç”¨æˆ·æ³¨å†Œæ—¶åŠ å¯†å¯†ç 
from app.core.security import get_password_hash

@router.post("/register")
def register(user_data: UserCreate, db: Session = Depends(get_db)):
    # âœ… åŠ å¯†å¯†ç 
    hashed_password = get_password_hash(user_data.password)
    
    user = User(
        username=user_data.username,
        email=user_data.email,
        password_hash=hashed_password  # å­˜å‚¨åŠ å¯†åçš„å¯†ç 
    )
    
    db.add(user)
    db.commit()
    
    return success_response(message="æ³¨å†ŒæˆåŠŸ")

# âŒ ç¦æ­¢: æ˜æ–‡å­˜å‚¨å¯†ç 
user = User(
    username=username,
    password=password  # å±é™©!
)
```

### 2. æ•æ„Ÿæ•°æ®åŠ å¯†

```python
from cryptography.fernet import Fernet

# ç”Ÿæˆå¯†é’¥(ä¿å­˜åˆ°ç¯å¢ƒå˜é‡)
# key = Fernet.generate_key()

class EncryptionService:
    """åŠ å¯†æœåŠ¡"""
    
    def __init__(self):
        # ä»ç¯å¢ƒå˜é‡è¯»å–å¯†é’¥
        key = os.getenv("ENCRYPTION_KEY")
        self.cipher = Fernet(key.encode())
    
    def encrypt(self, data: str) -> str:
        """åŠ å¯†æ•°æ®"""
        encrypted_data = self.cipher.encrypt(data.encode())
        return encrypted_data.decode()
    
    def decrypt(self, encrypted_data: str) -> str:
        """è§£å¯†æ•°æ®"""
        decrypted_data = self.cipher.decrypt(encrypted_data.encode())
        return decrypted_data.decode()

# ä½¿ç”¨ç¤ºä¾‹
encryption_service = EncryptionService()

# åŠ å¯† API å¯†é’¥
api_key = "sensitive-api-key"
encrypted_key = encryption_service.encrypt(api_key)

# å­˜å‚¨åˆ°æ•°æ®åº“
config = SystemConfig(
    config_key="api_key",
    config_value=encrypted_key  # å­˜å‚¨åŠ å¯†åçš„å€¼
)

# ä½¿ç”¨æ—¶è§£å¯†
decrypted_key = encryption_service.decrypt(config.config_value)
```

---

## âœ… è¾“å…¥éªŒè¯

### 1. åç«¯ Pydantic éªŒè¯

```python
from pydantic import BaseModel, Field, validator, EmailStr
import re

class UserCreate(BaseModel):
    """ç”¨æˆ·åˆ›å»ºéªŒè¯"""
    
    username: str = Field(..., min_length=3, max_length=20)
    email: EmailStr
    password: str = Field(..., min_length=8, max_length=50)
    
    @validator('username')
    def validate_username(cls, v):
        """ç”¨æˆ·åéªŒè¯"""
        # åªå…è®¸å­—æ¯ã€æ•°å­—ã€ä¸‹åˆ’çº¿
        if not re.match(r'^[a-zA-Z0-9_]+$', v):
            raise ValueError('ç”¨æˆ·ååªèƒ½åŒ…å«å­—æ¯ã€æ•°å­—å’Œä¸‹åˆ’çº¿')
        return v
    
    @validator('password')
    def validate_password(cls, v):
        """å¯†ç å¼ºåº¦éªŒè¯"""
        # è‡³å°‘åŒ…å«ä¸€ä¸ªå¤§å†™å­—æ¯ã€ä¸€ä¸ªå°å†™å­—æ¯å’Œä¸€ä¸ªæ•°å­—
        if not re.search(r'[A-Z]', v):
            raise ValueError('å¯†ç å¿…é¡»åŒ…å«è‡³å°‘ä¸€ä¸ªå¤§å†™å­—æ¯')
        if not re.search(r'[a-z]', v):
            raise ValueError('å¯†ç å¿…é¡»åŒ…å«è‡³å°‘ä¸€ä¸ªå°å†™å­—æ¯')
        if not re.search(r'\d', v):
            raise ValueError('å¯†ç å¿…é¡»åŒ…å«è‡³å°‘ä¸€ä¸ªæ•°å­—')
        return v

class CourseCreate(BaseModel):
    """è¯¾ç¨‹åˆ›å»ºéªŒè¯"""
    
    title: str = Field(..., min_length=2, max_length=200)
    description: str = Field(None, max_length=2000)
    
    @validator('title')
    def validate_title(cls, v):
        """æ ‡é¢˜éªŒè¯"""
        # ç§»é™¤é¦–å°¾ç©ºç™½
        v = v.strip()
        if not v:
            raise ValueError('æ ‡é¢˜ä¸èƒ½ä¸ºç©º')
        # ç¦æ­¢ç‰¹æ®Šå­—ç¬¦
        if re.search(r'[<>\"\'&]', v):
            raise ValueError('æ ‡é¢˜åŒ…å«éæ³•å­—ç¬¦')
        return v
```

### 2. å‰ç«¯è¡¨å•éªŒè¯

```vue
<template>
  <el-form
    ref="formRef"
    :model="formData"
    :rules="formRules"
  >
    <el-form-item label="ç”¨æˆ·å" prop="username">
      <el-input v-model="formData.username" />
    </el-form-item>
    
    <el-form-item label="å¯†ç " prop="password">
      <el-input v-model="formData.password" type="password" />
    </el-form-item>
  </el-form>
</template>

<script setup>
import { ref, reactive } from 'vue'

const formRef = ref(null)

const formData = reactive({
  username: '',
  password: ''
})

// éªŒè¯è§„åˆ™
const formRules = {
  username: [
    { required: true, message: 'è¯·è¾“å…¥ç”¨æˆ·å', trigger: 'blur' },
    { min: 3, max: 20, message: 'é•¿åº¦åœ¨ 3 åˆ° 20 ä¸ªå­—ç¬¦', trigger: 'blur' },
    { 
      pattern: /^[a-zA-Z0-9_]+$/,
      message: 'åªèƒ½åŒ…å«å­—æ¯ã€æ•°å­—å’Œä¸‹åˆ’çº¿',
      trigger: 'blur'
    }
  ],
  password: [
    { required: true, message: 'è¯·è¾“å…¥å¯†ç ', trigger: 'blur' },
    { min: 8, message: 'å¯†ç è‡³å°‘ 8 ä¸ªå­—ç¬¦', trigger: 'blur' },
    {
      validator: (rule, value, callback) => {
        if (!/[A-Z]/.test(value)) {
          callback(new Error('å¯†ç å¿…é¡»åŒ…å«è‡³å°‘ä¸€ä¸ªå¤§å†™å­—æ¯'))
        } else if (!/[a-z]/.test(value)) {
          callback(new Error('å¯†ç å¿…é¡»åŒ…å«è‡³å°‘ä¸€ä¸ªå°å†™å­—æ¯'))
        } else if (!/\d/.test(value)) {
          callback(new Error('å¯†ç å¿…é¡»åŒ…å«è‡³å°‘ä¸€ä¸ªæ•°å­—'))
        } else {
          callback()
        }
      },
      trigger: 'blur'
    }
  ]
}

async function handleSubmit() {
  // éªŒè¯è¡¨å•
  await formRef.value.validate()
  // æäº¤æ•°æ®...
}
</script>
```

---

## ğŸ›¡ï¸ SQL æ³¨å…¥é˜²æŠ¤

### 1. ä½¿ç”¨ ORM(æ¨è)

```python
from sqlalchemy.orm import Session

# âœ… æ­£ç¡®: ä½¿ç”¨ ORM,è‡ªåŠ¨é˜²æ­¢ SQL æ³¨å…¥
@router.get("/courses")
def get_courses(
    search: str = None,
    db: Session = Depends(get_db)
):
    query = db.query(Course)
    
    if search:
        # ORM ä¼šè‡ªåŠ¨è½¬ä¹‰å‚æ•°
        query = query.filter(Course.title.ilike(f"%{search}%"))
    
    courses = query.all()
    return success_response(data=[c.to_dict() for c in courses])

# âŒ å±é™©: æ‹¼æ¥ SQL å­—ç¬¦ä¸²
def get_courses_unsafe(search: str):
    # å±é™©! å­˜åœ¨ SQL æ³¨å…¥é£é™©
    sql = f"SELECT * FROM courses WHERE title LIKE '%{search}%'"
    result = db.execute(sql)
```

### 2. ä½¿ç”¨å‚æ•°åŒ–æŸ¥è¯¢

```python
from sqlalchemy import text

# âœ… æ­£ç¡®: ä½¿ç”¨å‚æ•°åŒ–æŸ¥è¯¢
def get_user_by_username(username: str, db: Session):
    sql = text("SELECT * FROM users WHERE username = :username")
    result = db.execute(sql, {"username": username})
    return result.first()

# âŒ å±é™©: å­—ç¬¦ä¸²æ‹¼æ¥
def get_user_unsafe(username: str, db: Session):
    sql = f"SELECT * FROM users WHERE username = '{username}'"
    result = db.execute(sql)  # SQLæ³¨å…¥é£é™©!
```

---

## ğŸš« XSS é˜²æŠ¤

### 1. è¾“å‡ºè½¬ä¹‰

```vue
<template>
  <div>
    <!-- âœ… Vue è‡ªåŠ¨è½¬ä¹‰ -->
    <p>{{ userInput }}</p>
    
    <!-- âŒ å±é™©: v-html ä¸è½¬ä¹‰ -->
    <div v-html="userInput"></div>  <!-- XSSé£é™©! -->
    
    <!-- âœ… å¦‚æœå¿…é¡»ä½¿ç”¨ v-html,å…ˆæ¸…ç† -->
    <div v-html="sanitizedInput"></div>
  </div>
</template>

<script setup>
import { computed } from 'vue'
import DOMPurify from 'dompurify'

const userInput = ref('<script>alert("XSS")</script>')

// æ¸…ç† HTML
const sanitizedInput = computed(() => {
  return DOMPurify.sanitize(userInput.value)
})
</script>
```

### 2. åç«¯ HTML æ¸…ç†

```python
import bleach

def sanitize_html(html_content: str) -> str:
    """æ¸…ç† HTML,é˜²æ­¢ XSS"""
    
    # å…è®¸çš„æ ‡ç­¾
    allowed_tags = ['p', 'br', 'strong', 'em', 'u', 'a']
    
    # å…è®¸çš„å±æ€§
    allowed_attributes = {'a': ['href', 'title']}
    
    # æ¸…ç† HTML
    clean_html = bleach.clean(
        html_content,
        tags=allowed_tags,
        attributes=allowed_attributes,
        strip=True
    )
    
    return clean_html

# ä½¿ç”¨
@router.post("/articles")
def create_article(article: ArticleCreate, db: Session = Depends(get_db)):
    # æ¸…ç†ç”¨æˆ·è¾“å…¥çš„ HTML
    clean_content = sanitize_html(article.content)
    
    new_article = Article(
        title=article.title,
        content=clean_content  # å­˜å‚¨æ¸…ç†åçš„å†…å®¹
    )
    
    db.add(new_article)
    db.commit()
    
    return success_response(data=new_article.to_dict())
```

---

## ğŸ” CSRF é˜²æŠ¤

### 1. ä½¿ç”¨ CSRF Token

```python
# backend/app/main.py
from fastapi import FastAPI
from fastapi.middleware.csrf import CSRFMiddleware

app = FastAPI()

# æ·»åŠ  CSRF ä¸­é—´ä»¶
app.add_middleware(
    CSRFMiddleware,
    secret_key="your-secret-key"
)
```

### 2. SameSite Cookie

```python
from fastapi import Response

@router.post("/login")
def login(response: Response, user_data: LoginRequest):
    # åˆ›å»º token
    access_token = create_access_token(data={"sub": user.id})
    
    # è®¾ç½® Cookie,å¯ç”¨ SameSite
    response.set_cookie(
        key="access_token",
        value=access_token,
        httponly=True,  # é˜²æ­¢ JS è®¿é—®
        secure=True,    # ä»… HTTPS
        samesite="strict"  # é˜²æ­¢ CSRF
    )
    
    return success_response(message="ç™»å½•æˆåŠŸ")
```

---

## ğŸ”’ API å®‰å…¨

### 1. è¯·æ±‚é™æµ

```python
from slowapi import Limiter
from slowapi.util import get_remote_address

limiter = Limiter(key_func=get_remote_address)

@router.post("/login")
@limiter.limit("5/minute")  # æ¯åˆ†é’Ÿæœ€å¤š 5 æ¬¡è¯·æ±‚
def login(request: Request, user_data: LoginRequest):
    # ç™»å½•é€»è¾‘
    pass

@router.post("/api/courses")
@limiter.limit("100/hour")  # æ¯å°æ—¶æœ€å¤š 100 æ¬¡è¯·æ±‚
def create_course(request: Request, course: CourseCreate):
    # åˆ›å»ºè¯¾ç¨‹
    pass
```

### 2. CORS é…ç½®

```python
from fastapi.middleware.cors import CORSMiddleware

app.add_middleware(
    CORSMiddleware,
    allow_origins=[
        "https://yourdomain.com",  # ç”Ÿäº§ç¯å¢ƒåŸŸå
        "http://localhost:3000"     # å¼€å‘ç¯å¢ƒ
    ],
    allow_credentials=True,
    allow_methods=["GET", "POST", "PUT", "DELETE"],
    allow_headers=["*"],
)
```

---

## ğŸ” æ•æ„Ÿä¿¡æ¯ä¿æŠ¤

### 1. ç¯å¢ƒå˜é‡ç®¡ç†

```python
# backend/.env (ä¸è¦æäº¤åˆ° Git!)
DATABASE_URL=mysql://user:password@localhost/db
SECRET_KEY=your-secret-key
JWT_SECRET_KEY=your-jwt-secret
ENCRYPTION_KEY=your-encryption-key

# backend/.env.example (å¯ä»¥æäº¤)
DATABASE_URL=mysql://user:password@localhost/db
SECRET_KEY=change-me
JWT_SECRET_KEY=change-me
ENCRYPTION_KEY=change-me

# backend/app/core/config.py
import os
from dotenv import load_dotenv

load_dotenv()

class Settings:
    DATABASE_URL = os.getenv("DATABASE_URL")
    SECRET_KEY = os.getenv("SECRET_KEY")
    JWT_SECRET_KEY = os.getenv("JWT_SECRET_KEY")
    
    # éªŒè¯å¿…éœ€çš„ç¯å¢ƒå˜é‡
    def __init__(self):
        if not self.SECRET_KEY:
            raise ValueError("SECRET_KEY æœªè®¾ç½®")

settings = Settings()
```

### 2. .gitignore é…ç½®

```bash
# .gitignore

# ç¯å¢ƒå˜é‡æ–‡ä»¶
.env
.env.local
.env.*.local

# æ•æ„Ÿé…ç½®
config.py
secrets.yml

# æ—¥å¿—æ–‡ä»¶(å¯èƒ½åŒ…å«æ•æ„Ÿä¿¡æ¯)
*.log
logs/

# æ•°æ®åº“æ–‡ä»¶
*.db
*.sqlite

# å¯†é’¥æ–‡ä»¶
*.pem
*.key
*.crt
```

### 3. å“åº”ä¸­éšè—æ•æ„Ÿä¿¡æ¯

```python
class User(Base):
    """ç”¨æˆ·æ¨¡å‹"""
    __tablename__ = "users"
    
    id = Column(BigInteger, primary_key=True)
    username = Column(String(50))
    email = Column(String(100))
    password_hash = Column(String(255))  # å¯†ç å“ˆå¸Œ
    api_key = Column(String(100))        # API å¯†é’¥
    
    def to_dict(self, include_sensitive=False):
        """è½¬æ¢ä¸ºå­—å…¸"""
        data = {
            "id": self.id,
            "username": self.username,
            "email": self.email
            # âŒ ä¸è¦åŒ…å« password_hash, api_key
        }
        
        # ä»…åœ¨éœ€è¦æ—¶åŒ…å«æ•æ„Ÿä¿¡æ¯
        if include_sensitive:
            data["api_key"] = self.api_key
        
        return data

# API å“åº”
@router.get("/profile")
def get_profile(current_user = Depends(get_current_user)):
    # âœ… ä¸è¿”å›å¯†ç ç­‰æ•æ„Ÿä¿¡æ¯
    return success_response(data=current_user.to_dict())
```

---

## ğŸ’¡ æœ€ä½³å®è·µ

### 1. å®‰å…¨æ£€æŸ¥æ¸…å•

```markdown
## å¼€å‘é˜¶æ®µ

- [ ] æ‰€æœ‰å¯†ç éƒ½å·²åŠ å¯†å­˜å‚¨
- [ ] ä½¿ç”¨ JWT æˆ– Session è¿›è¡Œè®¤è¯
- [ ] API æœ‰æƒé™æ§åˆ¶
- [ ] è¾“å…¥æ•°æ®å·²éªŒè¯
- [ ] ä½¿ç”¨ ORM é˜²æ­¢ SQL æ³¨å…¥
- [ ] è¾“å‡ºå·²è½¬ä¹‰é˜²æ­¢ XSS
- [ ] æ•æ„Ÿä¿¡æ¯æœªç¡¬ç¼–ç 
- [ ] .env æ–‡ä»¶æœªæäº¤åˆ° Git

## éƒ¨ç½²é˜¶æ®µ

- [ ] å¯ç”¨ HTTPS
- [ ] é…ç½® CORS ç™½åå•
- [ ] å¯ç”¨è¯·æ±‚é™æµ
- [ ] å…³é—­è°ƒè¯•æ¨¡å¼
- [ ] é…ç½®å®‰å…¨å“åº”å¤´
- [ ] å®šæœŸæ›´æ–°ä¾èµ–åŒ…
```

### 2. å®‰å…¨å“åº”å¤´

```python
from fastapi.middleware.trustedhost import TrustedHostMiddleware
from fastapi.middleware.httpsredirect import HTTPSRedirectMiddleware

# HTTPS é‡å®šå‘
app.add_middleware(HTTPSRedirectMiddleware)

# ä¿¡ä»»çš„ä¸»æœº
app.add_middleware(
    TrustedHostMiddleware,
    allowed_hosts=["yourdomain.com", "www.yourdomain.com"]
)

# è‡ªå®šä¹‰å“åº”å¤´
@app.middleware("http")
async def add_security_headers(request, call_next):
    response = await call_next(request)
    response.headers["X-Content-Type-Options"] = "nosniff"
    response.headers["X-Frame-Options"] = "DENY"
    response.headers["X-XSS-Protection"] = "1; mode=block"
    response.headers["Strict-Transport-Security"] = "max-age=31536000"
    return response
```

### 3. å®šæœŸå®‰å…¨å®¡è®¡

```bash
# Python ä¾èµ–å®‰å…¨æ£€æŸ¥
pip install safety
safety check

# JavaScript ä¾èµ–å®‰å…¨æ£€æŸ¥
npm audit

# ä»£ç å®‰å…¨æ‰«æ
pip install bandit
bandit -r backend/app/
```

---

## ğŸ“š å‚è€ƒèµ„æº

- [OWASP Top 10](https://owasp.org/www-project-top-ten/)
- [FastAPI Security](https://fastapi.tiangolo.com/tutorial/security/)
- [Vue.js Security](https://vuejs.org/guide/best-practices/security.html)

---

**è®°ä½**: å®‰å…¨æ˜¯ç³»ç»Ÿçš„åŸºçŸ³ï¼Œæ°¸è¿œä¸è¦åœ¨å®‰å…¨ä¸Šå¦¥åï¼
